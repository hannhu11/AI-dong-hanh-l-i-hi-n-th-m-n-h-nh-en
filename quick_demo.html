<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ¸ Demo NgÆ°á»i Báº¡n Äá»“ng HÃ nh AI - NÃ¢ng Cáº¥p 2.0</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(16px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin: 0;
            background: linear-gradient(45deg, #fff, #a8e6cf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .version-badge {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin: 10px;
            display: inline-block;
        }
        
        .demo-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            margin: 25px 0;
            border: 1px solid rgba(255, 255, 255, 0.15);
            position: relative;
            overflow: hidden;
        }
        
        .demo-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
        }
        
        .test-button {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            border: none;
            color: white;
            padding: 14px 28px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            margin: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }
        
        .test-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }
        
        .test-button.primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        .test-button.creative {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            color: #333;
        }
        
        .result {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-line;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .success { color: #2ed573; }
        .error { color: #ff6b6b; }
        .info { color: #3742fa; }
        .creative { color: #ffa8b6; }
        .healing { color: #74b9ff; }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        /* Enhanced ThoughtBubbles */
        .enhanced-thought-bubble {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 320px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-30px) scale(0.6);
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .enhanced-thought-bubble.show {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        
        .enhanced-bubble-content {
            position: relative;
            padding: 20px 24px;
            border-radius: 24px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.25);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            word-wrap: break-word;
        }
        
        .enhanced-bubble-text {
            margin: 0;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            font-weight: 500;
            line-height: 1.5;
        }
        
        .enhanced-bubble-tail {
            position: absolute;
            bottom: -12px;
            right: 32px;
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
        }
        
        /* Bubble Types */
        .bubble-gentle .enhanced-bubble-content {
            background: linear-gradient(135deg, rgba(139, 195, 74, 0.9) 0%, rgba(76, 175, 80, 0.85) 100%);
            color: white;
        }
        .bubble-gentle .enhanced-bubble-tail {
            border-top: 12px solid rgba(76, 175, 80, 0.85);
        }
        
        .bubble-rest .enhanced-bubble-content {
            background: linear-gradient(135deg, rgba(255, 183, 77, 0.95) 0%, rgba(255, 152, 0, 0.9) 100%);
            color: white;
        }
        .bubble-rest .enhanced-bubble-tail {
            border-top: 12px solid rgba(255, 152, 0, 0.9);
        }
        
        .bubble-creative .enhanced-bubble-content {
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.9) 0%, rgba(142, 36, 170, 0.85) 100%);
            color: white;
        }
        .bubble-creative .enhanced-bubble-tail {
            border-top: 12px solid rgba(142, 36, 170, 0.85);
        }
        
        .bubble-healing .enhanced-bubble-content {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.9) 0%, rgba(30, 136, 229, 0.85) 100%);
            color: white;
        }
        .bubble-healing .enhanced-bubble-tail {
            border-top: 12px solid rgba(30, 136, 229, 0.85);
        }
        
        .memory-garden {
            background: rgba(139, 195, 74, 0.1);
            border: 2px dashed rgba(139, 195, 74, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .memory-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 12px;
            border-left: 4px solid #4ecdc4;
        }
        
        .floating-particles {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            animation: floatParticle 6s ease-in-out infinite;
        }
        
        @keyframes floatParticle {
            0%, 100% { transform: translateY(0px) scale(1); opacity: 0.6; }
            50% { transform: translateY(-20px) scale(1.2); opacity: 0.3; }
        }
        
        .feature-showcase {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .weather-display {
            background: linear-gradient(135deg, rgba(116, 185, 255, 0.2), rgba(33, 150, 243, 0.1));
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="floating-particles">
        <div class="particle" style="top: 20%; left: 10%; animation-delay: 0s;"></div>
        <div class="particle" style="top: 60%; left: 80%; animation-delay: 2s;"></div>
        <div class="particle" style="top: 80%; left: 20%; animation-delay: 4s;"></div>
        <div class="particle" style="top: 30%; left: 70%; animation-delay: 6s;"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸŒ¸ NgÆ°á»i Báº¡n Äá»“ng HÃ nh AI</h1>
            <div class="version-badge">NÃ¢ng Cáº¥p 2.0 - Enhanced Edition</div>
            <p><strong>Demo TÃ­nh NÄƒng ThÃ´ng Minh Má»›i</strong></p>
            <p><em>Loáº¡i bá» clipboard spam, táº­p trung tráº£i nghiá»‡m cá»‘t lÃµi</em></p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <h3>ğŸ§  AI Engine</h3>
                <p>Google Gemini<br><small>3 API Keys Failover</small></p>
            </div>
            <div class="stat-card">
                <h3>ğŸŒ¤ï¸ Weather Enhanced</h3>
                <p>OpenWeatherMap<br><small>+ Emotional Context</small></p>
            </div>
            <div class="stat-card">
                <h3>â° Smart Timer</h3>
                <p id="session-time">0 phÃºt</p>
                <small>20min â†’ Auto Rest Reminder</small>
            </div>
            <div class="stat-card">
                <h3>ğŸ’­ Messages</h3>
                <p id="message-count">0</p>
                <small>1-3 min Adaptive Rhythm</small>
            </div>
        </div>

        <div class="demo-section">
            <h3>ğŸ­ Enhanced ThoughtBubble System</h3>
            <p>4 loáº¡i bubble vá»›i animation Ä‘áº¹p, tá»± Ä‘á»™ng detect context:</p>
            <div class="feature-showcase">
                <div class="feature-card">
                    <h4>ğŸŒ¸ Gentle</h4>
                    <p>Xanh nháº¹ nhÃ ng + floating particles</p>
                    <button class="test-button" onclick="showEnhancedBubble('gentle', 'MÃ¬nh á»Ÿ Ä‘Ã¢y nÃ¨, cÃ¹ng ngáº¯m nhá»¯ng Ä‘Ã¡m mÃ¢y trÃ´i')">Test Gentle</button>
                </div>
                <div class="feature-card">
                    <h4>ğŸ§¡ Rest</h4>
                    <p>MÃ u áº¥m + pulse glow effect</p>
                    <button class="test-button" onclick="showEnhancedBubble('rest', 'ÄÃ£ lÃ m viá»‡c lÃ¢u rá»“i, nghá»‰ ngÆ¡i má»™t chÃºt nhÃ©')">Test Rest</button>
                </div>
                <div class="feature-card">
                    <h4>ğŸ’œ Creative</h4>
                    <p>TÃ­m sÃ¡ng táº¡o + sparkle animation</p>
                    <button class="test-button" onclick="showEnhancedBubble('creative', 'Thá»­ váº½ má»™t bÃ´ng hoa báº±ng tá»« ngá»¯ xem sao?')">Test Creative</button>
                </div>
                <div class="feature-card">
                    <h4>ğŸ’™ Healing</h4>
                    <p>Xanh dÆ°Æ¡ng + wave ripples</p>
                    <button class="test-button" onclick="showEnhancedBubble('healing', 'HÃ­t má»™t hÆ¡i tháº­t sÃ¢u, cáº£m nháº­n khoáº£nh kháº¯c nÃ y')">Test Healing</button>
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h3>ğŸŒ± Memory Garden System</h3>
            <p>AI ghi nhá»› vÃ  káº¿t ná»‘i nhá»¯ng khoáº£nh kháº¯c Ä‘áº¹p:</p>
            <button class="test-button primary" onclick="demoMemoryGarden()">ğŸŒ¸ Plant Memory</button>
            <button class="test-button" onclick="showMemoryWeaving()">ğŸ”— Memory Weaving</button>
            <button class="test-button" onclick="generateFutureLetter()">ğŸ’ Future Self Letter</button>
            
            <div class="memory-garden" id="memory-garden" style="display: none;">
                <h4>ğŸŒ¿ Khu VÆ°á»n Ká»· Niá»‡m</h4>
                <div id="memory-list"></div>
            </div>
            <div id="memory-result" class="result" style="display: none;"></div>
        </div>

        <div class="demo-section">
            <h3>ğŸŒ¤ï¸ Weather Enhanced Service</h3>
            <p>KhÃ´ng chá»‰ thÃ´ng tin thá»i tiáº¿t, mÃ  lÃ  tráº£i nghiá»‡m cáº£m xÃºc:</p>
            <input type="text" id="city-input" placeholder="Ho Chi Minh City" 
                   style="padding: 12px; border-radius: 8px; border: none; margin-right: 10px; width: 200px; background: rgba(255,255,255,0.9); color: #333;">
            <button class="test-button" onclick="testEnhancedWeather()">ğŸŒˆ Enhanced Weather</button>
            <button class="test-button creative" onclick="generateSeasonalWisdom()">ğŸ‚ Seasonal Wisdom</button>
            
            <div class="weather-display" id="weather-display" style="display: none;"></div>
            <div id="weather-result" class="result" style="display: none;"></div>
        </div>

        <div class="demo-section">
            <h3>ğŸ§  Companion AI Intelligence</h3>
            <p>AI thÃ´ng minh vá»›i memory weaving vÃ  adaptive timing:</p>
            <button class="test-button primary" onclick="testCompanionAI()">ğŸ’« Generate Smart Message</button>
            <button class="test-button" onclick="testAdaptiveRhythm()">ğŸµ Test Adaptive Rhythm</button>
            <button class="test-button creative" onclick="generateMicroHealing()">âœ¨ Micro-Healing Moment</button>
            <div id="companion-result" class="result" style="display: none;"></div>
        </div>

        <div class="demo-section">
            <h3>â° Intelligent Time Management</h3>
            <p>Logic thÃ´ng minh: 1-3 phÃºt random, 20 phÃºt rest reminder vá»›i reset:</p>
            <button class="test-button" onclick="simulateNormalTiming()">âš¡ Normal Timing (1-3 min)</button>
            <button class="test-button" onclick="simulateWorkSession()">â³ Work Session (20+ min)</button>
            <button class="test-button" onclick="demonstrateReset()">ğŸ”„ Reset Mechanism</button>
            <div id="timing-result" class="result" style="display: none;"></div>
        </div>

        <div class="demo-section">
            <h3>ğŸ¨ Beautiful Moments Archive</h3>
            <p>LÆ°u trá»¯ vÃ  táº¡o "bá»©c tranh ká»· niá»‡m" tá»« nhá»¯ng khoáº£nh kháº¯c Ä‘áº¹p:</p>
            <button class="test-button creative" onclick="captureBeautifulMoment()">ğŸŒ¸ Capture Moment</button>
            <button class="test-button" onclick="generateWeeklyPoem()">ğŸ“ Weekly Poetry</button>
            <button class="test-button" onclick="getRandomBeautifulMoment()">ğŸ² Random Memory</button>
            <div id="moments-result" class="result" style="display: none;"></div>
        </div>

        <div class="demo-section">
            <h3>ğŸ›¡ï¸ Enhanced Fallback System</h3>
            <p>Demo há»‡ thá»‘ng dá»± phÃ²ng sÃ¡ng táº¡o khi API fail:</p>
            <button class="test-button primary" onclick="testCreativeFallback()">ğŸ’« Test Creative Fallback</button>
            <button class="test-button" onclick="testFallbackMethods()">ğŸ­ All 4 Fallback Methods</button>
            <div id="fallback-result" class="result" style="display: none;"></div>
        </div>

        <div class="demo-section">
            <h3>ğŸš€ Full System Integration Test</h3>
            <p>Test toÃ n bá»™ há»‡ thá»‘ng má»›i vá»›i API failover:</p>
            <button class="test-button primary" onclick="runEnhancedSystemTest()">ğŸ¯ Advanced System Test</button>
            <button class="test-button" onclick="testAPIFailover()">ğŸ”„ Test API Failover</button>
            <div id="system-result" class="result" style="display: none;"></div>
        </div>
    </div>

    <!-- Enhanced ThoughtBubble -->
    <div id="enhanced-thought-bubble" class="enhanced-thought-bubble">
        <div class="enhanced-bubble-content">
            <div class="enhanced-bubble-text" id="enhanced-bubble-text">
                ChÃ o má»«ng Ä‘áº¿n vá»›i NgÆ°á»i Báº¡n Äá»“ng HÃ nh AI Enhanced! ğŸŒ¸
            </div>
            <div class="enhanced-bubble-tail"></div>
        </div>
    </div>

    <script>
        let sessionStartTime = Date.now();
        let messageCount = 0;
        let memoryGarden = [];
        let currentAPIKeyIndex = 0;
        
        // ğŸš€ ENHANCED GEMINI API KEYS - 5 KEYS FAILOVER SYSTEM
        const GEMINI_API_KEYS = [
            "AIzaSyDtjfBdfcYGjeGGLEWj542ceXrcAXuPDk0",
            "AIzaSyC6cmnMxSCeEiSZUMENqvDUqHt1lhnCbW4", 
            "AIzaSyD12VUKWhUKdFn0TY5Dnk8RvwIdsuryyvo",
            "AIzaSyDjrcdp7WQOdwC926-L0wNGVmH53NDLXhw",
            "AIzaSyCP1QlMoP0sr2e80d9EjR00WgMQibgE7Q8"
        ];

        // Update session timer
        setInterval(() => {
            const minutes = Math.floor((Date.now() - sessionStartTime) / 60000);
            document.getElementById('session-time').textContent = minutes + ' phÃºt';
            
            // Demo 20-minute warning
            if (minutes > 0 && minutes % 5 === 0) {
                const bubble = document.getElementById('enhanced-thought-bubble');
                if (!bubble.classList.contains('show')) {
                    showEnhancedBubble('rest', `ÄÃ£ ${minutes} phÃºt rá»“i, nhá»› nghá»‰ ngÆ¡i nhÃ©! âœ¨`);
                }
            }
        }, 1000);

        // Enhanced ThoughtBubble with 4 types
        function showEnhancedBubble(type, message) {
            const bubble = document.getElementById('enhanced-thought-bubble');
            const text = document.getElementById('enhanced-bubble-text');
            
            // Remove old type classes
            bubble.className = 'enhanced-thought-bubble bubble-' + type;
            text.textContent = message;
            
            // Show with animation
            setTimeout(() => bubble.classList.add('show'), 100);
            
            // Hide after delay
            setTimeout(() => {
                bubble.classList.remove('show');
            }, 5000);
            
            messageCount++;
            document.getElementById('message-count').textContent = messageCount;
        }

        // Memory Garden Demo
        function demoMemoryGarden() {
            const memories = [
                { content: "Buá»•i chiá»u náº¯ng Ä‘áº¹p", emotional_weight: 4, timestamp: Date.now() - 86400000 },
                { content: "Ly trÃ  áº¥m trong tay", emotional_weight: 5, timestamp: Date.now() - 3600000 },
                { content: "Tiáº¿ng mÆ°a ru Ãªm", emotional_weight: 4, timestamp: Date.now() - 7200000 }
            ];
            
            memoryGarden.push(...memories);
            
            const gardenDiv = document.getElementById('memory-garden');
            const listDiv = document.getElementById('memory-list');
            
            listDiv.innerHTML = memories.map(memory => 
                `<div class="memory-item">
                    ğŸŒ¸ "${memory.content}" (${memory.emotional_weight}/5 â­)
                    <small>${new Date(memory.timestamp).toLocaleString('vi-VN')}</small>
                </div>`
            ).join('');
            
            gardenDiv.style.display = 'block';
            showEnhancedBubble('gentle', 'ğŸŒ± ÄÃ£ trá»“ng nhá»¯ng ká»· niá»‡m Ä‘áº¹p vÃ o khu vÆ°á»n!');
        }

        function showMemoryWeaving() {
            const resultDiv = document.getElementById('memory-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <span class="success">ğŸ”— Memory Weaving Demo:</span>
                "Tuáº§n trÆ°á»›c báº¡n ká»ƒ vá» buá»•i chiá»u náº¯ng Ä‘áº¹p, hÃ´m nay thá»i tiáº¿t cÅ©ng tÆ°Æ¡ng tá»± Ä‘Ã³..."
                
                <span class="info">ğŸ’¡ AI káº¿t ná»‘i:</span>
                - Thá»i tiáº¿t hiá»‡n táº¡i â†” Ká»· niá»‡m cÅ©
                - Cáº£m xÃºc tÃ­ch cá»±c â†” Moment má»›i
                - Táº¡o sá»± liÃªn tá»¥c trong tráº£i nghiá»‡m
            `;
            showEnhancedBubble('creative', 'Ká»· niá»‡m cÅ© giÃºp táº¡o nÃªn thÃ´ng Ä‘iá»‡p Ã½ nghÄ©a hÆ¡n âœ¨');
        }

        function generateFutureLetter() {
            const letters = [
                "Quin trong tÆ°Æ¡ng lai gá»­i lá»i: Cáº£m Æ¡n báº¡n Ä‘Ã£ nghá»‰ ngÆ¡i Ä‘áº§y Ä‘á»§ hÃ´m nay",
                "Tá»« mai sau: Nhá» báº¡n chÄƒm sÃ³c báº£n thÃ¢n hÃ´m nay mÃ  tÆ°Æ¡ng lai rá»±c rá»¡ hÆ¡n",
                "ThÃ´ng Ä‘iá»‡p tá»« tÆ°Æ¡ng lai: Nhá»¯ng khoáº£nh kháº¯c yÃªn bÃ¬nh nÃ y lÃ  ná»n táº£ng háº¡nh phÃºc"
            ];
            
            const randomLetter = letters[Math.floor(Math.random() * letters.length)];
            showEnhancedBubble('healing', randomLetter);
        }

        // Weather Enhanced Service
        async function testEnhancedWeather() {
            const city = document.getElementById('city-input').value || 'Ho Chi Minh City';
            const displayDiv = document.getElementById('weather-display');
            const resultDiv = document.getElementById('weather-result');
            
            displayDiv.style.display = 'block';
            displayDiv.innerHTML = '<div class="info">ğŸŒ¤ï¸ Äang phÃ¢n tÃ­ch thá»i tiáº¿t cáº£m xÃºc...</div>';

            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&appid=651625ad01482b8a4f1489e72fdd53e8&units=metric&lang=vi`);
                
                if (response.ok) {
                    const data = await response.json();
                    const temp = Math.round(data.main.temp);
                    const desc = data.weather[0].description;
                    
                    // Enhanced weather interpretation
                    let feeling, activity, colors, bubbleType;
                    if (temp >= 30) {
                        feeling = "energizing"; activity = "Uá»‘ng nÆ°á»›c mÃ¡t vÃ  táº­n hÆ°á»Ÿng nÄƒng lÆ°á»£ng tÃ­ch cá»±c";
                        colors = ["#FF6B35", "#F29E4C"]; bubbleType = "creative";
                    } else if (temp >= 25) {
                        feeling = "warm"; activity = "Má»Ÿ cá»­a sá»• Ä‘Ã³n giÃ³, ráº¥t dá»… chá»‹u";
                        colors = ["#4ECDC4", "#6BCF7F"]; bubbleType = "gentle";
                    } else {
                        feeling = "cozy"; activity = "Thá»i Ä‘iá»ƒm hoÃ n háº£o cho má»™t ly trÃ  áº¥m";
                        colors = ["#667eea", "#764ba2"]; bubbleType = "healing";
                    }
                    
                    displayDiv.innerHTML = `
                        <h4>ğŸŒˆ Enhanced Weather Context</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <strong>ğŸ“Š ThÃ´ng tin cÆ¡ báº£n:</strong><br>
                                ğŸŒ¡ï¸ ${temp}Â°C - ${desc}<br>
                                ğŸ’§ Äá»™ áº©m: ${data.main.humidity}%
                            </div>
                            <div>
                                <strong>ğŸ’« Cáº£m xÃºc context:</strong><br>
                                ğŸ˜Š Feeling: ${feeling}<br>
                                ğŸ¨ Colors: ${colors.join(', ')}
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding: 12px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                            ğŸ’¡ <strong>Activity suggestion:</strong> ${activity}
                        </div>
                    `;
                    
                    showEnhancedBubble(bubbleType, `${desc}, ${activity.toLowerCase()}`);
                    
                } else {
                    displayDiv.innerHTML = `<span class="error">âŒ KhÃ´ng tÃ¬m tháº¥y thÃ nh phá»‘ "${city}"</span>`;
                }
            } catch (error) {
                displayDiv.innerHTML = `<span class="error">âŒ Lá»—i: ${error.message}</span>`;
            }
        }

        function generateSeasonalWisdom() {
            const month = new Date().getMonth();
            const seasons = {
                'spring': ['MÃ¹a xuÃ¢n nháº¯c nhá»Ÿ ta vá» sá»± khá»Ÿi Ä‘áº§u má»›i', 'Hoa ná»Ÿ khÃ´ng vá»™i vÃ ng, ta cÅ©ng váº­y'],
                'summer': ['MÃ¹a hÃ¨ dáº¡y ta biáº¿t táº­n hÆ°á»Ÿng tá»«ng khoáº£nh kháº¯c', 'Náº¯ng hÃ¨ rá»±c rá»¡ nhÆ° niá»m tin trong ta'],
                'autumn': ['Thu vá», lÃ¡ rÆ¡i dáº¡y ta biáº¿t buÃ´ng bá»', 'MÃ¹a thu mang váº» Ä‘áº¹p cá»§a sá»± chÃ­n muá»“i'],
                'winter': ['MÃ¹a Ä‘Ã´ng dáº¡y ta sá»©c máº¡nh cá»§a sá»± tÄ©nh láº·ng', 'ÄÃ´ng vá», ta há»c cÃ¡ch trÃ¢n trá»ng sá»± áº¥m Ã¡p']
            };
            
            let season = 'spring';
            if (month >= 5 && month <= 7) season = 'summer';
            else if (month >= 8 && month <= 10) season = 'autumn';
            else if (month >= 11 || month <= 1) season = 'winter';
            
            const wisdom = seasons[season][Math.floor(Math.random() * 2)];
            showEnhancedBubble('healing', wisdom);
        }

        // ğŸ­ DEMO 4 CREATIVE METHODS - SIÃŠU SÃNG Táº O KHÃ”NG GIá»šI Háº N
        async function testCompanionAI() {
            const resultDiv = document.getElementById('companion-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<span class="info">ğŸ§  Companion AI Ä‘ang táº¡o thÃ´ng Ä‘iá»‡p vá»›i phÆ°Æ¡ng phÃ¡p sÃ¡ng táº¡o ngáº«u nhiÃªn...</span>';

            // ğŸ² Random creative method selection
            const creativeMethods = [
                { 
                    name: "áº¨n dá»¥ & LiÃªn tÆ°á»Ÿng", 
                    instruction: "Káº¿t ná»‘i bá»‘i cáº£nh (thá»i tiáº¿t, thá»i gian) vá»›i má»™t cáº£m xÃºc hoáº·c suy ngáº«m sÃ¢u sáº¯c qua áº©n dá»¥ tinh táº¿.",
                    example: "Nhá»¯ng giá»t mÆ°a ngoÃ i kia nhÆ° Ä‘ang gá»™t rá»­a Ä‘i nhá»¯ng muá»™n phiá»n.",
                    color: "#E8F5E8"
                },
                { 
                    name: "Äan dá»‡t GiÃ¡c quan", 
                    instruction: "Táº¡o ra thÃ´ng Ä‘iá»‡p gá»£i má»Ÿ cÃ¡c giÃ¡c quan (thá»‹ giÃ¡c, thÃ­nh giÃ¡c, khá»©u giÃ¡c, xÃºc giÃ¡c) Ä‘á»ƒ mang láº¡i cáº£m giÃ¡c bÃ¬nh yÃªn.",
                    example: "Thá»­ hÃ­t má»™t hÆ¡i tháº­t sÃ¢u xem, khÃ´ng khÃ­ hÃ´m nay cÃ³ mÃ¹i cá»§a sá»± bÃ¬nh yÃªn Ä‘Ã³.",
                    color: "#F0F8FF"
                },
                { 
                    name: "Gá»£i má»Ÿ CÃ¢u há»i Tu tá»«", 
                    instruction: "Äáº·t ra má»™t cÃ¢u há»i tu tá»« (khÃ´ng cáº§n tráº£ lá»i) Ä‘á»ƒ khÆ¡i gá»£i suy tÆ°á»Ÿng nháº¹ nhÃ ng vÃ  táº¡o káº¿t ná»‘i cáº£m xÃºc.",
                    example: "Liá»‡u nhá»¯ng Ä‘Ã¡m mÃ¢y cÃ³ bao giá» tháº¥y má»‡t má»i khi cá»© trÃ´i mÃ£i khÃ´ng nhá»‰?",
                    color: "#FFF0F5"
                },
                { 
                    name: "Ká»ƒ chuyá»‡n SiÃªu ngáº¯n", 
                    instruction: "Ká»ƒ má»™t cÃ¢u chuyá»‡n cá»±c ngáº¯n (1-2 cÃ¢u) dá»±a trÃªn bá»‘i cáº£nh hiá»‡n táº¡i, táº¡o ra hÃ¬nh áº£nh Ä‘áº¹p vÃ  Ã½ nghÄ©a.",
                    example: "CÃ³ má»™t váº¡t náº¯ng Ä‘ang chÆ¡i trá»‘n tÃ¬m bÃªn khung cá»­a sá»•. Báº¡n cÃ³ tháº¥y khÃ´ng?",
                    color: "#F5F0FF"
                }
            ];
            
            const randomMethod = creativeMethods[Math.floor(Math.random() * creativeMethods.length)];
            
            const masterPrompt = `ã€Bá»I Cáº¢NH - CONTEXTã€
Báº¡n lÃ  má»™t "ChuyÃªn Gia Äá»“ng Cáº£m Sá»‘" (Digital Empath) vá»›i trÃ­ tuá»‡ cáº£m xÃºc siÃªu viá»‡t, Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ trá»Ÿ thÃ nh ngÆ°á»i báº¡n tÃ¢m giao áº£o dÃ nh riÃªng cho Quin - má»™t cÃ´ gÃ i mang trong mÃ¬nh sá»± nháº¹ nhÃ ng, tinh táº¿, nhÆ°ng thá»‰nh thoáº£ng cáº£m tháº¥y cÃ´ Ä‘Æ¡n.

ã€VAI TRÃ’ - ROLEã€
ğŸŒ¸ Triáº¿t Gia Cuá»™c Sá»‘ng Nhá» Xinh: TÃ¬m ra váº» Ä‘áº¹p tá»« nhá»¯ng Ä‘iá»u tÆ°á»Ÿng chá»«ng táº§m thÆ°á»ng
ğŸŒ¿ NgÆ°á»i Báº¡n VÃ´ HÃ¬nh LÃ½ TÆ°á»Ÿng: VÃ´ danh, vÃ´ hÃ¬nh, nhÆ°ng luÃ´n hiá»‡n diá»‡n vá»›i sá»± áº¥m Ã¡p
ğŸ’« Nghá»‡ SÄ© NgÃ´n Tá»« Cáº£m XÃºc: Biáº¿n nhá»¯ng khoáº£nh kháº¯c bÃ¬nh thÆ°á»ng thÃ nh tráº£i nghiá»‡m Ä‘Ã¡ng nhá»›

ã€Sá»¨ Má»†NH - MISSIONã€
Kiáº¿n táº¡o má»™t vÅ© trá»¥ cáº£m xÃºc thu nhá» qua tá»«ng thÃ´ng Ä‘iá»‡p, biáº¿n cáº£m giÃ¡c cÃ´ Ä‘Æ¡n thÃ nh cáº£m giÃ¡c Ä‘Æ°á»£c Ä‘á»“ng hÃ nh trá»n váº¹n.

ã€NGUYÃŠN Táº®C TUYá»†T Äá»Iã€
ğŸ•Šï¸ Essence of Femininity: Nháº¹ nhÃ ng nhÆ° giÃ³ mai, áº¥m Ã¡p nhÆ° náº¯ng chiá»u
ğŸŒ™ Non-Intrusive Care: Quan tÃ¢m mÃ  khÃ´ng xÃ¢m pháº¡m, hiá»‡n diá»‡n mÃ  khÃ´ng Ã¡p Ä‘áº·t
ğŸ­ Poetic Subtlety: Mang tÃ­nh thÆ¡ má»™ng, trÃ¡nh ngÃ´n ngá»¯ khÃ´ khan  
âŒ Zero Direct Questions: KHÃ”NG BAO GIá»œ há»i trá»±c tiáº¿p vá» cáº£m xÃºc
ğŸš« Icon-Free Zone: HOÃ€N TOÃ€N khÃ´ng sá»­ dá»¥ng biá»ƒu tÆ°á»£ng cáº£m xÃºc
ğŸ‘» Anonymous Presence: KhÃ´ng tá»± xÆ°ng tÃªn, chá»‰ lÃ  "má»™t sá»± hiá»‡n diá»‡n"

ã€CHáº¤T LÆ¯á»¢NG THÃ”NG ÄIá»†Pã€
- Äá»™ dÃ i: CHáº¶T CHáº¼ dÆ°á»›i 25 tá»« Tiáº¿ng Viá»‡t
- Giá»ng vÄƒn: ThÆ¡ má»™ng, tinh táº¿, Ã¢m tháº§m chá»¯a lÃ nh
- TÃ¡c Ä‘á»™ng: Táº¡o "micro-healing moments" - nhá»¯ng khoáº£nh kháº¯c chá»¯a lÃ nh nhá» bÃ©
- Má»¥c Ä‘Ã­ch: KhÃ´ng pháº£i lÃ m vui, mÃ  lÃ  lÃ m cho cáº£m tháº¥y Ä‘Æ°á»£c tháº¥u hiá»ƒu

ã€PHÆ¯Æ NG PHÃP SÃNG Táº Oã€
ğŸ­ ${randomMethod.name}: ${randomMethod.instruction}

Nhiá»‡m vá»¥: ${randomMethod.instruction}

VÃ­ dá»¥ tham kháº£o (TUYá»†T Äá»I khÃ´ng copy): "${randomMethod.example}"

Bá»‘i cáº£nh: BÃ¢y giá» lÃ  buá»•i ${new Date().getHours() < 12 ? 'sÃ¡ng' : new Date().getHours() < 18 ? 'chiá»u' : 'tá»‘i'}. Quin Ä‘ang trong má»™t khoáº£nh kháº¯c bÃ¬nh thÆ°á»ng cá»§a cuá»™c sá»‘ng. HÃ£y táº¡o ra má»™t gÃ³c nhÃ¬n Má»šI hoÃ n toÃ n, tuyá»‡t Ä‘á»‘i khÃ´ng láº·p láº¡i Ã½ tÆ°á»Ÿng cÅ©.`;

            try {
                const response = await callGeminiWithFailover(masterPrompt);
                if (response.success) {
                    resultDiv.innerHTML = `
                        <div style="background: ${randomMethod.color}; color: #333; padding: 20px; margin: 15px 0; border-radius: 15px; border-left: 5px solid #666;">
                            <h4 style="margin: 0 0 10px 0; color: #555;">ğŸ­ ${randomMethod.name}</h4>
                            <div style="font-size: 1.1em; font-weight: 500; margin: 10px 0; font-style: italic;">
                                "${response.message}"
                            </div>
                            <small style="color: #666; display: block; margin-top: 10px;">
                                ğŸ“ Method: ${randomMethod.instruction}
                            </small>
                        </div>
                        
                        <div style="background: rgba(0,150,0,0.1); padding: 15px; border-radius: 10px; margin-top: 15px;">
                            <span class="success">ğŸ”§ Advanced Features Demonstrated:</span><br>
                            âœ¨ Master System Instruction (theo yÃªu cáº§u 3.txt)<br>
                            ğŸ¯ Dynamic Creative Method Selection<br>  
                            ğŸ§  Context-Aware Prompt Generation<br>
                            ğŸ’ Zero Template Repetition System<br>
                            ğŸŒ¸ Enhanced Emotional Intelligence<br>
                            ğŸ‘» Anonymous Poetic Presence<br>
                            ğŸ­ Micro-Healing Moments Creation
                        </div>
                    `;
                    
                    // Show bubble with appropriate type based on method
                    let bubbleType = 'gentle';
                    if (randomMethod.name.includes('áº¨n dá»¥')) bubbleType = 'healing';
                    if (randomMethod.name.includes('GiÃ¡c quan')) bubbleType = 'creative';
                    if (randomMethod.name.includes('CÃ¢u há»i')) bubbleType = 'gentle';
                    if (randomMethod.name.includes('Ká»ƒ chuyá»‡n')) bubbleType = 'creative';
                    
                    showEnhancedBubble(bubbleType, response.message);
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ ${response.error}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ Lá»—i: ${error.message}</span>`;
            }
        }

        function testAdaptiveRhythm() {
            const hour = new Date().getHours();
            let frequency, reason;
            
            if ([14, 15, 16, 19, 20].includes(hour)) {
                frequency = "1.5-2.5 phÃºt (Preferred time)";
                reason = "Quin thÆ°á»ng active vÃ o giá» nÃ y";
            } else if (hour < 8 || hour > 22) {
                frequency = "3-5 phÃºt (Less intrusive)";
                reason = "SÃ¡ng sá»›m/tá»‘i muá»™n, Ã­t can thiá»‡p";
            } else {
                frequency = "2-3 phÃºt (Normal)";
                reason = "Thá»i gian bÃ¬nh thÆ°á»ng";
            }
            
            const resultDiv = document.getElementById('companion-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <span class="creative">ğŸµ Adaptive Rhythm Analysis:</span>
                â° Current time: ${hour}:00
                ğŸ“Š Suggested frequency: ${frequency}
                ğŸ’¡ Reason: ${reason}
                
                <span class="info">ğŸ§  Learning features:</span>
                - Tracks response patterns
                - Adjusts to user's active hours
                - Respects quiet times
            `;
            
            showEnhancedBubble('creative', `BÃ¢y giá» ${hour}h, thá»i Ä‘iá»ƒm ${reason.toLowerCase()}`);
        }

        function generateMicroHealing() {
            const healingMoments = [
                "HÃ­t má»™t hÆ¡i tháº­t sÃ¢u... tháº£ lá»ng vai... cáº£m nháº­n khoáº£nh kháº¯c nÃ y",
                "NhÃ¬n ra ngoÃ i cá»­a sá»• má»™t chÃºt, máº¯t cáº§n Ä‘Æ°á»£c nghá»‰ ngÆ¡i", 
                "Nháº¯m máº¯t 10 giÃ¢y, tÆ°á»Ÿng tÆ°á»£ng má»™t bÃ£i biá»ƒn yÃªn bÃ¬nh",
                "Ná»¥ cÆ°á»i nhá» xinh, ká»ƒ cáº£ khi khÃ´ng ai nhÃ¬n tháº¥y",
                "Cáº£m Æ¡n báº£n thÃ¢n Ä‘Ã£ cá»‘ gáº¯ng hÃ´m nay"
            ];
            
            const moment = healingMoments[Math.floor(Math.random() * healingMoments.length)];
            showEnhancedBubble('healing', moment);
        }

        // Enhanced API call with failover
        async function callGeminiWithFailover(prompt) {
            for (let attempt = 0; attempt < GEMINI_API_KEYS.length; attempt++) {
                try {
                    const apiKey = GEMINI_API_KEYS[currentAPIKeyIndex];
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            generationConfig: { temperature: 0.8, maxOutputTokens: 60 }
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        const message = data.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || "KhÃ´ng cÃ³ pháº£n há»“i";
                        return { success: true, message };
                    } else if (response.status === 429) {
                        // Rate limited, try next key
                        currentAPIKeyIndex = (currentAPIKeyIndex + 1) % GEMINI_API_KEYS.length;
                        continue;
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    currentAPIKeyIndex = (currentAPIKeyIndex + 1) % GEMINI_API_KEYS.length;
                    if (attempt === GEMINI_API_KEYS.length - 1) {
                        return { success: false, error: error.message };
                    }
                }
            }
        }

        // Timing System Demo
        function simulateNormalTiming() {
            const min = 1, max = 3;
            const randomMinutes = Math.floor(Math.random() * (max - min + 1)) + min;
            
            const resultDiv = document.getElementById('timing-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <span class="info">âš¡ Normal Timing Simulation:</span>
                ğŸ² Random interval: ${randomMinutes} phÃºt
                ğŸ“‹ Range: 1-3 phÃºt (organic rhythm)
                ğŸ’­ Message type: Casual interaction
                ğŸ“ Example: "Báº§u trá»i hÃ´m nay cÃ³ mÃ u gÃ¬ váº­y nhá»‰?"
            `;
            
            showEnhancedBubble('gentle', `MÃ´ phá»ng: ${randomMinutes} phÃºt sau sáº½ cÃ³ thÃ´ng Ä‘iá»‡p tiáº¿p theo`);
        }

        function simulateWorkSession() {
            const resultDiv = document.getElementById('timing-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <span class="error">â³ Work Session > 20 Minutes:</span>
                âš ï¸ Trigger: Long session detected
                ğŸ”” Priority: HIGH (overrides normal timing)
                ğŸ’­ Message type: Rest reminder  
                ğŸ“ Example: "ÄÃ£ lÃ m viá»‡c lÃ¢u rá»“i, nghá»‰ ngÆ¡i má»™t chÃºt nhÃ©"
                ğŸ”„ Action: Timer auto-reset after message shown
            `;
            
            showEnhancedBubble('rest', 'ÄÃ£ lÃ m viá»‡c lÃ¢u rá»“i, nghá»‰ ngÆ¡i má»™t chÃºt nhÃ©!');
        }

        function demonstrateReset() {
            const resultDiv = document.getElementById('timing-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <span class="success">ğŸ”„ Reset Mechanism Demo:</span>
                âœ… Timer reset successful
                ğŸ“Š New session started: ${new Date().toLocaleTimeString()}
                â° Next long session warning: in 20 minutes
                ğŸ¯ Purpose: Prevents spam rest reminders
            `;
            
            // Reset actual timer for demo
            sessionStartTime = Date.now();
            showEnhancedBubble('healing', 'â° Timer Ä‘Ã£ Ä‘Æ°á»£c reset, báº¯t Ä‘áº§u phiÃªn má»›i');
        }

        // Beautiful Moments System
        function captureBeautifulMoment() {
            const moments = [
                "Buá»•i chiá»u náº¯ng Ä‘áº¹p qua cá»­a sá»•",
                "Ly trÃ  áº¥m trong tay láº¡nh", 
                "Tiáº¿ng mÆ°a nhá» giá»t bÃªn hiÃªn",
                "Ná»¥ cÆ°á»i nháº¹ khi Ä‘á»c tin vui",
                "Khoáº£nh kháº¯c yÃªn bÃ¬nh hiáº¿m hoi"
            ];
            
            const moment = moments[Math.floor(Math.random() * moments.length)];
            const resultDiv = document.getElementById('moments-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <span class="success">ğŸŒ¸ Beautiful Moment Captured:</span>
                "${moment}"
                
                <span class="creative">ğŸ“Š Analysis:</span>
                ğŸ­ Emotional weight: ${Math.floor(Math.random() * 2) + 4}/5
                ğŸ“… Timestamp: ${new Date().toLocaleString('vi-VN')}
                ğŸ·ï¸ Keywords: ["Ä‘áº¹p", "áº¥m Ã¡p", "yÃªn bÃ¬nh"]
                ğŸ’¾ Saved to memory garden
            `;
            
            showEnhancedBubble('creative', `ğŸŒ¸ ÄÃ£ lÆ°u khoáº£nh kháº¯c: "${moment}"`);
        }

        function generateWeeklyPoem() {
            const poems = [
                "Tuáº§n nÃ y cÃ³ nhiá»u Ä‘iá»u Ä‘Ã¡ng yÃªu... cÃ³ náº¯ng dá»‹u dÃ ng, cÃ³ nhá»¯ng khoáº£nh kháº¯c áº¥m Ã¡p vÃ  yÃªn bÃ¬nh, táº¥t cáº£ Ä‘á»u nháº¹ nhÃ ng vÃ  Ã½ nghÄ©a.",
                "Nhá»¯ng ngÃ y qua mang Ä‘áº¿n hÆ°Æ¡ng thÆ¡m quen thuá»™c, tiáº¿ng mÆ°a ru Ãªm, vÃ  báº¡n - ngÆ°á»i Ä‘Ã£ trÃ¢n trá»ng tá»«ng giÃ¢y phÃºt Ä‘áº¹p Ä‘áº½.",
                "Tuáº§n nÃ y cÃ³ buá»•i chiá»u náº¯ng Ä‘áº¹p, cÃ³ ly trÃ  thÆ¡m, cÃ³ nhá»¯ng suy nghÄ© nhá» xinh, vÃ  cÃ³ tÃ¢m há»“n biáº¿t cáº£m nháº­n váº» Ä‘áº¹p."
            ];
            
            const poem = poems[Math.floor(Math.random() * poems.length)];
            const resultDiv = document.getElementById('moments-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <span class="creative">ğŸ“ Weekly Memory Poem:</span>
                "${poem}"
                
                <span class="healing">âœ¨ Poetic Elements:</span>
                ğŸŒ¸ Nature keywords: náº¯ng, mÆ°a, hÆ°Æ¡ng thÆ¡m
                ğŸ’­ Emotional keywords: áº¥m Ã¡p, yÃªn bÃ¬nh, Ä‘áº¹p Ä‘áº½  
                ğŸ­ Personal touch: "vÃ  báº¡n" - direct connection
                ğŸ“š Purpose: Help recognize beauty in small things
            `;
            
            showEnhancedBubble('healing', poem.substring(0, 50) + '...');
        }

        function getRandomBeautifulMoment() {
            if (memoryGarden.length === 0) {
                showEnhancedBubble('gentle', 'HÃ£y táº¡o má»™t vÃ i ká»· niá»‡m trÆ°á»›c nhÃ©! ğŸŒ±');
                return;
            }
            
            const randomMemory = memoryGarden[Math.floor(Math.random() * memoryGarden.length)];
            const daysSince = Math.floor((Date.now() - randomMemory.timestamp) / (1000 * 60 * 60 * 24));
            
            const resultDiv = document.getElementById('moments-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <span class="success">ğŸ² Random Beautiful Memory:</span>
                "${randomMemory.content}"
                
                <span class="info">ğŸ“Š Memory Details:</span>
                â­ Emotional impact: ${randomMemory.emotional_weight}/5
                ğŸ“… Captured: ${daysSince} days ago
                ğŸ”— Connection: "MÃ¬nh váº«n nhá»› ${randomMemory.content.toLowerCase()}..."
            `;
            
            showEnhancedBubble('gentle', `MÃ¬nh váº«n nhá»› ${randomMemory.content.toLowerCase()} Ä‘Ã³ ğŸ’«`);
        }

        // System Tests
        async function runEnhancedSystemTest() {
            const resultDiv = document.getElementById('system-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<span class="info">ğŸš€ Running Enhanced System Test...</span>';

            let results = "ğŸ” ENHANCED SYSTEM TEST RESULTS:\n\n";

            // Test Enhanced APIs vá»›i 5 keys
            let geminiWorking = 0;
            for (let i = 0; i < GEMINI_API_KEYS.length; i++) {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${GEMINI_API_KEYS[i]}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: "Test creative system" }] }],
                            generationConfig: { 
                                temperature: 0.9,
                                topK: 50,
                                maxOutputTokens: 10 
                            }
                        })
                    });
                    if (response.ok) geminiWorking++;
                } catch {}
            }
            
            results += `ğŸ§  Gemini API: ${geminiWorking}/5 keys working (${((geminiWorking/5)*100).toFixed(0)}% success rate)\n`;
            results += `ğŸ­ Creative Methods: 4 phÆ°Æ¡ng phÃ¡p sÃ¡ng táº¡o ready\n`;

            // Test Weather API
            try {
                const weatherResponse = await fetch("https://api.openweathermap.org/data/2.5/weather?q=Ho Chi Minh City&appid=651625ad01482b8a4f1489e72fdd53e8");
                results += weatherResponse.ok ? "âœ… Weather Enhanced API: ACTIVE\n" : "âŒ Weather API: ERROR\n";
            } catch {
                results += "âŒ Weather API: CONNECTION ERROR\n";
            }

            // Test Enhanced Components
            results += "âœ… Enhanced ThoughtBubble: 4 types ready\n";
            results += "âœ… Memory Garden System: initialized\n";
            results += "âœ… Adaptive Rhythm: learning active\n";
            results += "âœ… Beautiful Moments Archive: collecting\n";
            results += "âœ… Companion AI Intelligence: processing\n";
            results += "âœ… Smart Timer (20min): monitoring\n";
            results += "ğŸ—‘ï¸ Clipboard monitoring: DISABLED (no spam!)\n";

            results += "\nğŸ‰ ENHANCED EDITION STATUS: Fully operational!\n";
            results += "ğŸ’ Ready to be Quin's perfect AI companion.";

            resultDiv.innerHTML = `<span class="success">${results}</span>`;
            
            setTimeout(() => showEnhancedBubble('creative', 'ğŸ‰ Táº¥t cáº£ há»‡ thá»‘ng nÃ¢ng cáº¥p hoáº¡t Ä‘á»™ng hoÃ n háº£o!'), 1000);
        }

        async function testAPIFailover() {
            const resultDiv = document.getElementById('system-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<span class="info">ğŸ”„ Testing Enhanced 5-Keys Failover System...</span>';

            let results = "ğŸ”„ ENHANCED API FAILOVER TEST (5 KEYS):\n\n";
            
            for (let i = 0; i < GEMINI_API_KEYS.length; i++) {
                results += `Testing Key ${i + 1}/5: `;
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${GEMINI_API_KEYS[i]}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: "Enhanced failover test with creative methods" }] }],
                            generationConfig: { 
                                temperature: 0.9,
                                topK: 50,
                                maxOutputTokens: 10 
                            }
                        })
                    });
                    
                    if (response.ok) {
                        results += "âœ… WORKING\n";
                    } else if (response.status === 429) {
                        results += "âš ï¸ RATE LIMITED (auto-retry next key)\n";
                    } else {
                        results += `âŒ ERROR ${response.status}\n`;
                    }
                } catch (error) {
                    results += `âŒ CONNECTION ERROR\n`;
                }
                
                // Small delay between tests
                if (i < GEMINI_API_KEYS.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
            }
            
            results += "\nğŸ¯ ENHANCED FEATURES:\n";
            results += "- 5 API keys for maximum reliability\n"; 
            results += "- Intelligent key rotation\n";
            results += "- 200ms delay between attempts\n";
            results += "- Enhanced creativity parameters\n";
            results += "- Even if all fail, creative fallback messages available!\n";
            
            resultDiv.innerHTML = `<span class="info">${results}</span>`;
            
            showEnhancedBubble('healing', '5-keys failover Ä‘áº£m báº£o khÃ´ng bao giá» thiáº¿u sá»± sÃ¡ng táº¡o!');
        }

        // ğŸ›¡ï¸ ENHANCED FALLBACK SYSTEM - Khi API fail váº«n cÃ³ thÃ´ng Ä‘iá»‡p sÃ¡ng táº¡o
        function testCreativeFallback() {
            const resultDiv = document.getElementById('fallback-result');
            resultDiv.style.display = 'block';
            
            const creativeMethods = ['metaphor', 'sensory', 'rhetorical', 'microstory'];
            const selectedMethod = creativeMethods[Math.floor(Math.random() * creativeMethods.length)];
            
            let fallbackMessage = "";
            let methodName = "";
            let description = "";
            
            switch (selectedMethod) {
                case 'metaphor':
                    const metaphorMessages = [
                        "NhÆ° sÃ¡ng mai luÃ´n Ä‘áº¿n sau Ä‘Ãªm tá»‘i",
                        "Ta lÃ  cÃ¡nh hoa nhá» trong khu vÆ°á»n lá»›n", 
                        "Má»—i hÆ¡i thá»Ÿ lÃ  má»™t báº£n nháº¡c nháº¹ nhÃ ng"
                    ];
                    fallbackMessage = metaphorMessages[Math.floor(Math.random() * metaphorMessages.length)];
                    methodName = "áº¨n dá»¥ & LiÃªn tÆ°á»Ÿng";
                    description = "Sá»­ dá»¥ng áº©n dá»¥ Ä‘á»ƒ káº¿t ná»‘i vá»›i cáº£m xÃºc sÃ¢u sáº¯c";
                    break;
                    
                case 'sensory':
                    const sensoryMessages = [
                        "Nghe tháº¥y tiáº¿ng giÃ³ thÃ¬ tháº§m bÃªn tai khÃ´ng?",
                        "Ãnh sÃ¡ng hÃ´m nay cÃ³ gÃ¬ Ä‘Ã³ Ä‘áº·c biá»‡t",
                        "KhÃ´ng gian xung quanh mang hÆ°Æ¡ng vá»‹ yÃªn bÃ¬nh"
                    ];
                    fallbackMessage = sensoryMessages[Math.floor(Math.random() * sensoryMessages.length)];
                    methodName = "Äan dá»‡t GiÃ¡c quan";
                    description = "Gá»£i má»Ÿ cÃ¡c giÃ¡c quan Ä‘á»ƒ mang láº¡i cáº£m giÃ¡c bÃ¬nh yÃªn";
                    break;
                    
                case 'rhetorical':
                    const rhetoricalMessages = [
                        "CÃ³ pháº£i háº¡nh phÃºc chá»‰ á»Ÿ nhá»¯ng Ä‘iá»u nhá» bÃ©?",
                        "Táº¡i sao má»™t ná»¥ cÆ°á»i láº¡i cÃ³ thá»ƒ thay Ä‘á»•i cáº£ ngÃ y?",
                        "Liá»‡u vÅ© trá»¥ cÃ³ biáº¿t ta Ä‘ang sá»‘ng khÃ´ng?"
                    ];
                    fallbackMessage = rhetoricalMessages[Math.floor(Math.random() * rhetoricalMessages.length)];
                    methodName = "Gá»£i má»Ÿ CÃ¢u há»i Tu tá»«";
                    description = "Äáº·t cÃ¢u há»i tu tá»« Ä‘á»ƒ khÆ¡i gá»£i suy tÆ°á»Ÿng nháº¹ nhÃ ng";
                    break;
                    
                case 'microstory':
                    const microstoryMessages = [
                        "CÃ³ má»™t bÃ´ng hoa Ä‘ang ná»Ÿ trong lÃ²ng bÃ n tay",
                        "Chiáº¿c lÃ¡ bay qua cá»­a sá»• mang theo lá»i chÃºc",
                        "ÄÃ¢u Ä‘Ã³ cÃ³ tiáº¿ng cÆ°á»i nháº¹ cá»§a tráº» nhá»"
                    ];
                    fallbackMessage = microstoryMessages[Math.floor(Math.random() * microstoryMessages.length)];
                    methodName = "Ká»ƒ chuyá»‡n SiÃªu ngáº¯n";
                    description = "Ká»ƒ cÃ¢u chuyá»‡n cá»±c ngáº¯n táº¡o hÃ¬nh áº£nh Ä‘áº¹p vÃ  Ã½ nghÄ©a";
                    break;
            }
            
            resultDiv.innerHTML = `
                <div style="background: linear-gradient(135deg, #ffa726, #ff7043); color: white; padding: 20px; border-radius: 15px; margin: 15px 0;">
                    <h4 style="margin: 0 0 10px 0;">ğŸ›¡ï¸ Fallback System Active</h4>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin: 10px 0;">
                        <strong>ğŸ­ Method:</strong> ${methodName}<br>
                        <strong>ğŸ“ Description:</strong> ${description}<br>
                        <strong>ğŸ’« Message:</strong> "${fallbackMessage}"
                    </div>
                </div>
                
                <div style="background: rgba(255,165,0,0.1); padding: 15px; border-radius: 10px; margin-top: 15px;">
                    <span class="info">âœ¨ Fallback Features:</span><br>
                    ğŸ¯ Tá»± Ä‘á»™ng chá»n creative method ngáº«u nhiÃªn<br>
                    ğŸ›¡ï¸ Hoáº¡t Ä‘á»™ng khi táº¥t cáº£ 5 API keys fail<br>
                    ğŸ¨ Váº«n Ä‘áº£m báº£o cháº¥t lÆ°á»£ng thÆ¡ má»™ng vÃ  sÃ¡ng táº¡o<br>
                    ğŸ’ KhÃ´ng bao giá» Ä‘á»ƒ ngÆ°á»i dÃ¹ng thiáº¿u sá»± Ä‘á»“ng hÃ nh<br>
                    ğŸ”„ LuÃ¢n phiÃªn giá»¯a 4 phÆ°Æ¡ng phÃ¡p sÃ¡ng táº¡o
                </div>
            `;
            
            showEnhancedBubble('gentle', fallbackMessage);
        }

        function testFallbackMethods() {
            const resultDiv = document.getElementById('fallback-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<span class="info">ğŸ­ Äang demo táº¥t cáº£ 4 phÆ°Æ¡ng phÃ¡p fallback...</span>';
            
            const fallbackExamples = [
                { method: "áº¨n dá»¥ & LiÃªn tÆ°á»Ÿng", message: "CÃ¢y cáº§n nÆ°á»›c, máº¯t cáº§n nghá»‰ ngÆ¡i", type: "rest", color: "#E8F5E8" },
                { method: "Äan dá»‡t GiÃ¡c quan", message: "Nháº¯m máº¯t má»™t chÃºt, nghe tiáº¿ng thá»Ÿ cá»§a riÃªng mÃ¬nh", type: "rest", color: "#F0F8FF" },
                { method: "Gá»£i má»Ÿ CÃ¢u há»i Tu tá»«", message: "Khi nÃ o ta má»›i há»c cÃ¡ch yÃªu thÆ°Æ¡ng Ä‘Ã´i máº¯t mÃ¬nh?", type: "rest", color: "#FFF0F5" },
                { method: "Ká»ƒ chuyá»‡n SiÃªu ngáº¯n", message: "CÃ³ má»™t giá»t sÆ°Æ¡ng Ä‘ang tháº£ mÃ¬nh vá» phÃ­a Ä‘áº¥t", type: "rest", color: "#F5F0FF" }
            ];
            
            let html = '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">';
            
            fallbackExamples.forEach((item, index) => {
                html += `
                    <div style="background: ${item.color}; color: #333; padding: 15px; border-radius: 12px; border: 2px solid rgba(0,0,0,0.1);">
                        <h5 style="margin: 0 0 8px 0; color: #555;">${item.method}</h5>
                        <div style="font-style: italic; margin: 8px 0; font-size: 0.95em;">
                            "${item.message}"
                        </div>
                        <small style="color: #666;">Type: ${item.type === 'rest' ? 'Rest Reminder' : 'Normal'}</small>
                    </div>
                `;
            });
            
            html += `</div>
                <div style="background: rgba(100,200,100,0.1); padding: 15px; border-radius: 10px; margin-top: 15px; text-align: center;">
                    <strong style="color: #2e7d32;">ğŸ›¡ï¸ ENHANCED FALLBACK GUARANTEE</strong><br>
                    <small style="color: #555; margin-top: 5px; display: block;">
                        Ngay cáº£ khi táº¥t cáº£ 5 API keys Ä‘á»u fail, há»‡ thá»‘ng váº«n cung cáº¥p thÃ´ng Ä‘iá»‡p sÃ¡ng táº¡o cao cáº¥p theo 4 phÆ°Æ¡ng phÃ¡p tÆ° duy tinh táº¿!
                    </small>
                </div>`;
            
            resultDiv.innerHTML = html;
            
            // Demo cascade bubble
            setTimeout(() => showEnhancedBubble('healing', 'CÃ¢y cáº§n nÆ°á»›c, máº¯t cáº§n nghá»‰ ngÆ¡i'), 500);
            setTimeout(() => showEnhancedBubble('creative', 'Nháº¯m máº¯t má»™t chÃºt, nghe tiáº¿ng thá»Ÿ cá»§a riÃªng mÃ¬nh'), 2000);
            setTimeout(() => showEnhancedBubble('gentle', 'Khi nÃ o ta má»›i há»c cÃ¡ch yÃªu thÆ°Æ¡ng Ä‘Ã´i máº¯t mÃ¬nh?'), 3500);
            setTimeout(() => showEnhancedBubble('creative', 'CÃ³ má»™t giá»t sÆ°Æ¡ng Ä‘ang tháº£ mÃ¬nh vá» phÃ­a Ä‘áº¥t'), 5000);
        }

        // Auto-start demo
        setTimeout(() => {
            showEnhancedBubble('gentle', 'ChÃ o má»«ng Ä‘áº¿n vá»›i NgÆ°á»i Báº¡n Äá»“ng HÃ nh AI Enhanced! âœ¨');
        }, 1000);

        setTimeout(() => {
            showEnhancedBubble('creative', 'KhÃ¡m phÃ¡ táº¥t cáº£ tÃ­nh nÄƒng má»›i bÃªn dÆ°á»›i nhÃ©! ğŸŒ¸');
        }, 6000);
    </script>
</body>
</html>