<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üå∏ Demo Ng∆∞·ªùi B·∫°n ƒê·ªìng H√†nh AI - N√¢ng C·∫•p 2.0</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(16px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin: 0;
            background: linear-gradient(45deg, #fff, #a8e6cf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .version-badge {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin: 10px;
            display: inline-block;
        }
        
        .demo-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            margin: 25px 0;
            border: 1px solid rgba(255, 255, 255, 0.15);
            position: relative;
            overflow: hidden;
        }
        
        .demo-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
        }
        
        .test-button {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            border: none;
            color: white;
            padding: 14px 28px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            margin: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }
        
        .test-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }
        
        .test-button.primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        .test-button.creative {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            color: #333;
        }
        
        .result {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-line;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .success { color: #2ed573; }
        .error { color: #ff6b6b; }
        .info { color: #3742fa; }
        .creative { color: #ffa8b6; }
        .healing { color: #74b9ff; }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        /* Enhanced ThoughtBubbles */
        .enhanced-thought-bubble {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 320px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-30px) scale(0.6);
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .enhanced-thought-bubble.show {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        
        .enhanced-bubble-content {
            position: relative;
            padding: 20px 24px;
            border-radius: 24px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.25);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            word-wrap: break-word;
        }
        
        .enhanced-bubble-text {
            margin: 0;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            font-weight: 500;
            line-height: 1.5;
        }
        
        .enhanced-bubble-tail {
            position: absolute;
            bottom: -12px;
            right: 32px;
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
        }
        
        /* Bubble Types */
        .bubble-gentle .enhanced-bubble-content {
            background: linear-gradient(135deg, rgba(139, 195, 74, 0.9) 0%, rgba(76, 175, 80, 0.85) 100%);
            color: white;
        }
        .bubble-gentle .enhanced-bubble-tail {
            border-top: 12px solid rgba(76, 175, 80, 0.85);
        }
        
        .bubble-rest .enhanced-bubble-content {
            background: linear-gradient(135deg, rgba(255, 183, 77, 0.95) 0%, rgba(255, 152, 0, 0.9) 100%);
            color: white;
        }
        .bubble-rest .enhanced-bubble-tail {
            border-top: 12px solid rgba(255, 152, 0, 0.9);
        }
        
        .bubble-creative .enhanced-bubble-content {
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.9) 0%, rgba(142, 36, 170, 0.85) 100%);
            color: white;
        }
        .bubble-creative .enhanced-bubble-tail {
            border-top: 12px solid rgba(142, 36, 170, 0.85);
        }
        
        .bubble-healing .enhanced-bubble-content {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.9) 0%, rgba(30, 136, 229, 0.85) 100%);
            color: white;
        }
        .bubble-healing .enhanced-bubble-tail {
            border-top: 12px solid rgba(30, 136, 229, 0.85);
        }
        
        .memory-garden {
            background: rgba(139, 195, 74, 0.1);
            border: 2px dashed rgba(139, 195, 74, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .memory-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 12px;
            border-left: 4px solid #4ecdc4;
        }
        
        .floating-particles {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            animation: floatParticle 6s ease-in-out infinite;
        }
        
        @keyframes floatParticle {
            0%, 100% { transform: translateY(0px) scale(1); opacity: 0.6; }
            50% { transform: translateY(-20px) scale(1.2); opacity: 0.3; }
        }
        
        .feature-showcase {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .weather-display {
            background: linear-gradient(135deg, rgba(116, 185, 255, 0.2), rgba(33, 150, 243, 0.1));
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="floating-particles">
        <div class="particle" style="top: 20%; left: 10%; animation-delay: 0s;"></div>
        <div class="particle" style="top: 60%; left: 80%; animation-delay: 2s;"></div>
        <div class="particle" style="top: 80%; left: 20%; animation-delay: 4s;"></div>
        <div class="particle" style="top: 30%; left: 70%; animation-delay: 6s;"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üå∏ Ng∆∞·ªùi B·∫°n ƒê·ªìng H√†nh AI</h1>
            <div class="version-badge">N√¢ng C·∫•p 2.0 - Enhanced Edition</div>
            <p><strong>Demo T√≠nh NƒÉng Th√¥ng Minh M·ªõi</strong></p>
            <p><em>Lo·∫°i b·ªè clipboard spam, t·∫≠p trung tr·∫£i nghi·ªám c·ªët l√µi</em></p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <h3>üß† AI Engine</h3>
                <p>Google Gemini<br><small>3 API Keys Failover</small></p>
            </div>
            <div class="stat-card">
                <h3>üå§Ô∏è Weather Enhanced</h3>
                <p>OpenWeatherMap<br><small>+ Emotional Context</small></p>
            </div>
            <div class="stat-card">
                <h3>‚è∞ Smart Timer</h3>
                <p id="session-time">0 ph√∫t</p>
                <small>20min ‚Üí Auto Rest Reminder</small>
            </div>
            <div class="stat-card">
                <h3>üí≠ Messages</h3>
                <p id="message-count">0</p>
                <small>1-3 min Adaptive Rhythm</small>
            </div>
        </div>

        <div class="demo-section">
            <h3>üé≠ Enhanced ThoughtBubble System</h3>
            <p>4 lo·∫°i bubble v·ªõi animation ƒë·∫πp, t·ª± ƒë·ªông detect context:</p>
            <div class="feature-showcase">
                <div class="feature-card">
                    <h4>üå∏ Gentle</h4>
                    <p>Xanh nh·∫π nh√†ng + floating particles</p>
                    <button class="test-button" onclick="showEnhancedBubble('gentle', 'M√¨nh ·ªü ƒë√¢y n√®, c√πng ng·∫Øm nh·ªØng ƒë√°m m√¢y tr√¥i')">Test Gentle</button>
                </div>
                <div class="feature-card">
                    <h4>üß° Rest</h4>
                    <p>M√†u ·∫•m + pulse glow effect</p>
                    <button class="test-button" onclick="showEnhancedBubble('rest', 'ƒê√£ l√†m vi·ªác l√¢u r·ªìi, ngh·ªâ ng∆°i m·ªôt ch√∫t nh√©')">Test Rest</button>
                </div>
                <div class="feature-card">
                    <h4>üíú Creative</h4>
                    <p>T√≠m s√°ng t·∫°o + sparkle animation</p>
                    <button class="test-button" onclick="showEnhancedBubble('creative', 'Th·ª≠ v·∫Ω m·ªôt b√¥ng hoa b·∫±ng t·ª´ ng·ªØ xem sao?')">Test Creative</button>
                </div>
                <div class="feature-card">
                    <h4>üíô Healing</h4>
                    <p>Xanh d∆∞∆°ng + wave ripples</p>
                    <button class="test-button" onclick="showEnhancedBubble('healing', 'H√≠t m·ªôt h∆°i th·∫≠t s√¢u, c·∫£m nh·∫≠n kho·∫£nh kh·∫Øc n√†y')">Test Healing</button>
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h3>üå± Memory Garden System</h3>
            <p>AI ghi nh·ªõ v√† k·∫øt n·ªëi nh·ªØng kho·∫£nh kh·∫Øc ƒë·∫πp:</p>
            <button class="test-button primary" onclick="demoMemoryGarden()">üå∏ Plant Memory</button>
            <button class="test-button" onclick="showMemoryWeaving()">üîó Memory Weaving</button>
            <button class="test-button" onclick="generateFutureLetter()">üíù Future Self Letter</button>
            
            <div class="memory-garden" id="memory-garden" style="display: none;">
                <h4>üåø Khu V∆∞·ªùn K·ª∑ Ni·ªám</h4>
                <div id="memory-list"></div>
            </div>
            <div id="memory-result" class="result" style="display: none;"></div>
        </div>

        <div class="demo-section">
            <h3>üå§Ô∏è Weather Enhanced Service</h3>
            <p>Kh√¥ng ch·ªâ th√¥ng tin th·ªùi ti·∫øt, m√† l√† tr·∫£i nghi·ªám c·∫£m x√∫c:</p>
            <input type="text" id="city-input" placeholder="Ho Chi Minh City" 
                   style="padding: 12px; border-radius: 8px; border: none; margin-right: 10px; width: 200px; background: rgba(255,255,255,0.9); color: #333;">
            <button class="test-button" onclick="testEnhancedWeather()">üåà Enhanced Weather</button>
            <button class="test-button creative" onclick="generateSeasonalWisdom()">üçÇ Seasonal Wisdom</button>
            
            <div class="weather-display" id="weather-display" style="display: none;"></div>
            <div id="weather-result" class="result" style="display: none;"></div>
        </div>

        <div class="demo-section">
            <h3>üß† Companion AI Intelligence</h3>
            <p>AI th√¥ng minh v·ªõi memory weaving v√† adaptive timing:</p>
            <button class="test-button primary" onclick="testCompanionAI()">üí´ Generate Smart Message</button>
            <button class="test-button" onclick="testAdaptiveRhythm()">üéµ Test Adaptive Rhythm</button>
            <button class="test-button creative" onclick="generateMicroHealing()">‚ú® Micro-Healing Moment</button>
            <div id="companion-result" class="result" style="display: none;"></div>
        </div>

        <div class="demo-section">
            <h3>‚è∞ Intelligent Time Management</h3>
            <p>Logic th√¥ng minh: 1-3 ph√∫t random, 20 ph√∫t rest reminder v·ªõi reset:</p>
            <button class="test-button" onclick="simulateNormalTiming()">‚ö° Normal Timing (1-3 min)</button>
            <button class="test-button" onclick="simulateWorkSession()">‚è≥ Work Session (20+ min)</button>
            <button class="test-button" onclick="demonstrateReset()">üîÑ Reset Mechanism</button>
            <div id="timing-result" class="result" style="display: none;"></div>
        </div>

        <div class="demo-section">
            <h3>üé® Beautiful Moments Archive</h3>
            <p>L∆∞u tr·ªØ v√† t·∫°o "b·ª©c tranh k·ª∑ ni·ªám" t·ª´ nh·ªØng kho·∫£nh kh·∫Øc ƒë·∫πp:</p>
            <button class="test-button creative" onclick="captureBeautifulMoment()">üå∏ Capture Moment</button>
            <button class="test-button" onclick="generateWeeklyPoem()">üìù Weekly Poetry</button>
            <button class="test-button" onclick="getRandomBeautifulMoment()">üé≤ Random Memory</button>
            <div id="moments-result" class="result" style="display: none;"></div>
        </div>

        <div class="demo-section">
            <h3>üõ°Ô∏è Enhanced Fallback System</h3>
            <p>Demo h·ªá th·ªëng d·ª± ph√≤ng s√°ng t·∫°o khi API fail:</p>
            <button class="test-button primary" onclick="testCreativeFallback()">üí´ Test Creative Fallback</button>
            <button class="test-button" onclick="testFallbackMethods()">üé≠ All 4 Fallback Methods</button>
            <div id="fallback-result" class="result" style="display: none;"></div>
        </div>

        <div class="demo-section">
            <h3>üöÄ Full System Integration Test</h3>
            <p>Test to√†n b·ªô h·ªá th·ªëng m·ªõi v·ªõi API failover:</p>
            <button class="test-button primary" onclick="runEnhancedSystemTest()">üéØ Advanced System Test</button>
            <button class="test-button" onclick="testAPIFailover()">üîÑ Test API Failover</button>
            <div id="system-result" class="result" style="display: none;"></div>
        </div>
    </div>

    <!-- Enhanced ThoughtBubble -->
    <div id="enhanced-thought-bubble" class="enhanced-thought-bubble">
        <div class="enhanced-bubble-content">
            <div class="enhanced-bubble-text" id="enhanced-bubble-text">
                Ch√†o m·ª´ng ƒë·∫øn v·ªõi Ng∆∞·ªùi B·∫°n ƒê·ªìng H√†nh AI Enhanced! üå∏
            </div>
            <div class="enhanced-bubble-tail"></div>
        </div>
    </div>

    <script>
        let sessionStartTime = Date.now();
        let messageCount = 0;
        let memoryGarden = [];
        let currentAPIKeyIndex = 0;
        
        // üöÄ ENHANCED GEMINI API KEYS - 5 KEYS FAILOVER SYSTEM
        const GEMINI_API_KEYS = [
            "AIzaSyDtjfBdfcYGjeGGLEWj542ceXrcAXuPDk0",
            "AIzaSyC6cmnMxSCeEiSZUMENqvDUqHt1lhnCbW4", 
            "AIzaSyD12VUKWhUKdFn0TY5Dnk8RvwIdsuryyvo",
            "AIzaSyDjrcdp7WQOdwC926-L0wNGVmH53NDLXhw",
            "AIzaSyCP1QlMoP0sr2e80d9EjR00WgMQibgE7Q8"
        ];

        // Update session timer
        setInterval(() => {
            const minutes = Math.floor((Date.now() - sessionStartTime) / 60000);
            document.getElementById('session-time').textContent = minutes + ' ph√∫t';
            
            // Demo 20-minute warning
            if (minutes > 0 && minutes % 5 === 0) {
                const bubble = document.getElementById('enhanced-thought-bubble');
                if (!bubble.classList.contains('show')) {
                    showEnhancedBubble('rest', `ƒê√£ ${minutes} ph√∫t r·ªìi, nh·ªõ ngh·ªâ ng∆°i nh√©! ‚ú®`);
                }
            }
        }, 1000);

        // Enhanced ThoughtBubble with 4 types
        function showEnhancedBubble(type, message) {
            const bubble = document.getElementById('enhanced-thought-bubble');
            const text = document.getElementById('enhanced-bubble-text');
            
            // Remove old type classes
            bubble.className = 'enhanced-thought-bubble bubble-' + type;
            text.textContent = message;
            
            // Show with animation
            setTimeout(() => bubble.classList.add('show'), 100);
            
            // Hide after delay
            setTimeout(() => {
                bubble.classList.remove('show');
            }, 5000);
            
            messageCount++;
            document.getElementById('message-count').textContent = messageCount;
        }

        // Memory Garden Demo
        function demoMemoryGarden() {
            const memories = [
                { content: "Bu·ªïi chi·ªÅu n·∫Øng ƒë·∫πp", emotional_weight: 4, timestamp: Date.now() - 86400000 },
                { content: "Ly tr√† ·∫•m trong tay", emotional_weight: 5, timestamp: Date.now() - 3600000 },
                { content: "Ti·∫øng m∆∞a ru √™m", emotional_weight: 4, timestamp: Date.now() - 7200000 }
            ];
            
            memoryGarden.push(...memories);
            
            const gardenDiv = document.getElementById('memory-garden');
            const listDiv = document.getElementById('memory-list');
            
            listDiv.innerHTML = memories.map(memory => 
                `<div class="memory-item">
                    üå∏ "${memory.content}" (${memory.emotional_weight}/5 ‚≠ê)
                    <small>${new Date(memory.timestamp).toLocaleString('vi-VN')}</small>
                </div>`
            ).join('');
            
            gardenDiv.style.display = 'block';
            showEnhancedBubble('gentle', 'üå± ƒê√£ tr·ªìng nh·ªØng k·ª∑ ni·ªám ƒë·∫πp v√†o khu v∆∞·ªùn!');
        }

        function showMemoryWeaving() {
            const resultDiv = document.getElementById('memory-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <span class="success">üîó Memory Weaving Demo:</span>
                "Tu·∫ßn tr∆∞·ªõc b·∫°n k·ªÉ v·ªÅ bu·ªïi chi·ªÅu n·∫Øng ƒë·∫πp, h√¥m nay th·ªùi ti·∫øt c≈©ng t∆∞∆°ng t·ª± ƒë√≥..."
                
                <span class="info">üí° AI k·∫øt n·ªëi:</span>
                - Th·ªùi ti·∫øt hi·ªán t·∫°i ‚Üî K·ª∑ ni·ªám c≈©
                - C·∫£m x√∫c t√≠ch c·ª±c ‚Üî Moment m·ªõi
                - T·∫°o s·ª± li√™n t·ª•c trong tr·∫£i nghi·ªám
            `;
            showEnhancedBubble('creative', 'K·ª∑ ni·ªám c≈© gi√∫p t·∫°o n√™n th√¥ng ƒëi·ªáp √Ω nghƒ©a h∆°n ‚ú®');
        }

        function generateFutureLetter() {
            const letters = [
                "Quin trong t∆∞∆°ng lai g·ª≠i l·ªùi: C·∫£m ∆°n b·∫°n ƒë√£ ngh·ªâ ng∆°i ƒë·∫ßy ƒë·ªß h√¥m nay",
                "T·ª´ mai sau: Nh·ªù b·∫°n chƒÉm s√≥c b·∫£n th√¢n h√¥m nay m√† t∆∞∆°ng lai r·ª±c r·ª° h∆°n",
                "Th√¥ng ƒëi·ªáp t·ª´ t∆∞∆°ng lai: Nh·ªØng kho·∫£nh kh·∫Øc y√™n b√¨nh n√†y l√† n·ªÅn t·∫£ng h·∫°nh ph√∫c"
            ];
            
            const randomLetter = letters[Math.floor(Math.random() * letters.length)];
            showEnhancedBubble('healing', randomLetter);
        }

        // Weather Enhanced Service
        async function testEnhancedWeather() {
            const city = document.getElementById('city-input').value || 'Ho Chi Minh City';
            const displayDiv = document.getElementById('weather-display');
            const resultDiv = document.getElementById('weather-result');
            
            displayDiv.style.display = 'block';
            displayDiv.innerHTML = '<div class="info">üå§Ô∏è ƒêang ph√¢n t√≠ch th·ªùi ti·∫øt c·∫£m x√∫c...</div>';

            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&appid=651625ad01482b8a4f1489e72fdd53e8&units=metric&lang=vi`);
                
                if (response.ok) {
                    const data = await response.json();
                    const temp = Math.round(data.main.temp);
                    const desc = data.weather[0].description;
                    
                    // Enhanced weather interpretation
                    let feeling, activity, colors, bubbleType;
                    if (temp >= 30) {
                        feeling = "energizing"; activity = "U·ªëng n∆∞·ªõc m√°t v√† t·∫≠n h∆∞·ªüng nƒÉng l∆∞·ª£ng t√≠ch c·ª±c";
                        colors = ["#FF6B35", "#F29E4C"]; bubbleType = "creative";
                    } else if (temp >= 25) {
                        feeling = "warm"; activity = "M·ªü c·ª≠a s·ªï ƒë√≥n gi√≥, r·∫•t d·ªÖ ch·ªãu";
                        colors = ["#4ECDC4", "#6BCF7F"]; bubbleType = "gentle";
                    } else {
                        feeling = "cozy"; activity = "Th·ªùi ƒëi·ªÉm ho√†n h·∫£o cho m·ªôt ly tr√† ·∫•m";
                        colors = ["#667eea", "#764ba2"]; bubbleType = "healing";
                    }
                    
                    displayDiv.innerHTML = `
                        <h4>üåà Enhanced Weather Context</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <strong>üìä Th√¥ng tin c∆° b·∫£n:</strong><br>
                                üå°Ô∏è ${temp}¬∞C - ${desc}<br>
                                üíß ƒê·ªô ·∫©m: ${data.main.humidity}%
                            </div>
                            <div>
                                <strong>üí´ C·∫£m x√∫c context:</strong><br>
                                üòä Feeling: ${feeling}<br>
                                üé® Colors: ${colors.join(', ')}
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding: 12px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                            üí° <strong>Activity suggestion:</strong> ${activity}
                        </div>
                    `;
                    
                    showEnhancedBubble(bubbleType, `${desc}, ${activity.toLowerCase()}`);
                    
                } else {
                    displayDiv.innerHTML = `<span class="error">‚ùå Kh√¥ng t√¨m th·∫•y th√†nh ph·ªë "${city}"</span>`;
                }
            } catch (error) {
                displayDiv.innerHTML = `<span class="error">‚ùå L·ªói: ${error.message}</span>`;
            }
        }

        function generateSeasonalWisdom() {
            const month = new Date().getMonth();
            const seasons = {
                'spring': ['M√πa xu√¢n nh·∫Øc nh·ªü ta v·ªÅ s·ª± kh·ªüi ƒë·∫ßu m·ªõi', 'Hoa n·ªü kh√¥ng v·ªôi v√†ng, ta c≈©ng v·∫≠y'],
                'summer': ['M√πa h√® d·∫°y ta bi·∫øt t·∫≠n h∆∞·ªüng t·ª´ng kho·∫£nh kh·∫Øc', 'N·∫Øng h√® r·ª±c r·ª° nh∆∞ ni·ªÅm tin trong ta'],
                'autumn': ['Thu v·ªÅ, l√° r∆°i d·∫°y ta bi·∫øt bu√¥ng b·ªè', 'M√πa thu mang v·∫ª ƒë·∫πp c·ªßa s·ª± ch√≠n mu·ªìi'],
                'winter': ['M√πa ƒë√¥ng d·∫°y ta s·ª©c m·∫°nh c·ªßa s·ª± tƒ©nh l·∫∑ng', 'ƒê√¥ng v·ªÅ, ta h·ªçc c√°ch tr√¢n tr·ªçng s·ª± ·∫•m √°p']
            };
            
            let season = 'spring';
            if (month >= 5 && month <= 7) season = 'summer';
            else if (month >= 8 && month <= 10) season = 'autumn';
            else if (month >= 11 || month <= 1) season = 'winter';
            
            const wisdom = seasons[season][Math.floor(Math.random() * 2)];
            showEnhancedBubble('healing', wisdom);
        }

        // üé≠ DEMO 4 CREATIVE METHODS - SI√äU S√ÅNG T·∫†O KH√îNG GI·ªöI H·∫†N
        async function testCompanionAI() {
            const resultDiv = document.getElementById('companion-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<span class="info">üß† Companion AI ƒëang t·∫°o th√¥ng ƒëi·ªáp v·ªõi ph∆∞∆°ng ph√°p s√°ng t·∫°o ng·∫´u nhi√™n...</span>';

            // üé≤ Random creative method selection
            const creativeMethods = [
                { 
                    name: "·∫®n d·ª• & Li√™n t∆∞·ªüng", 
                    instruction: "K·∫øt n·ªëi b·ªëi c·∫£nh (th·ªùi ti·∫øt, th·ªùi gian) v·ªõi m·ªôt c·∫£m x√∫c ho·∫∑c suy ng·∫´m s√¢u s·∫Øc qua ·∫©n d·ª• tinh t·∫ø.",
                    example: "Nh·ªØng gi·ªçt m∆∞a ngo√†i kia nh∆∞ ƒëang g·ªôt r·ª≠a ƒëi nh·ªØng mu·ªôn phi·ªÅn.",
                    color: "#E8F5E8"
                },
                { 
                    name: "ƒêan d·ªát Gi√°c quan", 
                    instruction: "T·∫°o ra th√¥ng ƒëi·ªáp g·ª£i m·ªü c√°c gi√°c quan (th·ªã gi√°c, th√≠nh gi√°c, kh·ª©u gi√°c, x√∫c gi√°c) ƒë·ªÉ mang l·∫°i c·∫£m gi√°c b√¨nh y√™n.",
                    example: "Th·ª≠ h√≠t m·ªôt h∆°i th·∫≠t s√¢u xem, kh√¥ng kh√≠ h√¥m nay c√≥ m√πi c·ªßa s·ª± b√¨nh y√™n ƒë√≥.",
                    color: "#F0F8FF"
                },
                { 
                    name: "G·ª£i m·ªü C√¢u h·ªèi Tu t·ª´", 
                    instruction: "ƒê·∫∑t ra m·ªôt c√¢u h·ªèi tu t·ª´ (kh√¥ng c·∫ßn tr·∫£ l·ªùi) ƒë·ªÉ kh∆°i g·ª£i suy t∆∞·ªüng nh·∫π nh√†ng v√† t·∫°o k·∫øt n·ªëi c·∫£m x√∫c.",
                    example: "Li·ªáu nh·ªØng ƒë√°m m√¢y c√≥ bao gi·ªù th·∫•y m·ªát m·ªèi khi c·ª© tr√¥i m√£i kh√¥ng nh·ªâ?",
                    color: "#FFF0F5"
                },
                { 
                    name: "K·ªÉ chuy·ªán Si√™u ng·∫Øn", 
                    instruction: "K·ªÉ m·ªôt c√¢u chuy·ªán c·ª±c ng·∫Øn (1-2 c√¢u) d·ª±a tr√™n b·ªëi c·∫£nh hi·ªán t·∫°i, t·∫°o ra h√¨nh ·∫£nh ƒë·∫πp v√† √Ω nghƒ©a.",
                    example: "C√≥ m·ªôt v·∫°t n·∫Øng ƒëang ch∆°i tr·ªën t√¨m b√™n khung c·ª≠a s·ªï. B·∫°n c√≥ th·∫•y kh√¥ng?",
                    color: "#F5F0FF"
                }
            ];
            
            const randomMethod = creativeMethods[Math.floor(Math.random() * creativeMethods.length)];
            
            const masterPrompt = `„ÄéB·ªêI C·∫¢NH - CONTEXT„Äè
B·∫°n l√† m·ªôt "Chuy√™n Gia ƒê·ªìng C·∫£m S·ªë" (Digital Empath) v·ªõi tr√≠ tu·ªá c·∫£m x√∫c si√™u vi·ªát, ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ tr·ªü th√†nh ng∆∞·ªùi b·∫°n t√¢m giao ·∫£o d√†nh ri√™ng cho Quin - m·ªôt c√¥ g√†i mang trong m√¨nh s·ª± nh·∫π nh√†ng, tinh t·∫ø, nh∆∞ng th·ªânh tho·∫£ng c·∫£m th·∫•y c√¥ ƒë∆°n.

„ÄéVAI TR√í - ROLE„Äè
üå∏ Tri·∫øt Gia Cu·ªôc S·ªëng Nh·ªè Xinh: T√¨m ra v·∫ª ƒë·∫πp t·ª´ nh·ªØng ƒëi·ªÅu t∆∞·ªüng ch·ª´ng t·∫ßm th∆∞·ªùng
üåø Ng∆∞·ªùi B·∫°n V√¥ H√¨nh L√Ω T∆∞·ªüng: V√¥ danh, v√¥ h√¨nh, nh∆∞ng lu√¥n hi·ªán di·ªán v·ªõi s·ª± ·∫•m √°p
üí´ Ngh·ªá Sƒ© Ng√¥n T·ª´ C·∫£m X√∫c: Bi·∫øn nh·ªØng kho·∫£nh kh·∫Øc b√¨nh th∆∞·ªùng th√†nh tr·∫£i nghi·ªám ƒë√°ng nh·ªõ

„ÄéS·ª® M·ªÜNH - MISSION„Äè
Ki·∫øn t·∫°o m·ªôt v≈© tr·ª• c·∫£m x√∫c thu nh·ªè qua t·ª´ng th√¥ng ƒëi·ªáp, bi·∫øn c·∫£m gi√°c c√¥ ƒë∆°n th√†nh c·∫£m gi√°c ƒë∆∞·ª£c ƒë·ªìng h√†nh tr·ªçn v·∫πn.

„ÄéNGUY√äN T·∫ÆC TUY·ªÜT ƒê·ªêI„Äè
üïäÔ∏è Essence of Femininity: Nh·∫π nh√†ng nh∆∞ gi√≥ mai, ·∫•m √°p nh∆∞ n·∫Øng chi·ªÅu
üåô Non-Intrusive Care: Quan t√¢m m√† kh√¥ng x√¢m ph·∫°m, hi·ªán di·ªán m√† kh√¥ng √°p ƒë·∫∑t
üé≠ Poetic Subtlety: Mang t√≠nh th∆° m·ªông, tr√°nh ng√¥n ng·ªØ kh√¥ khan  
‚ùå Zero Direct Questions: KH√îNG BAO GI·ªú h·ªèi tr·ª±c ti·∫øp v·ªÅ c·∫£m x√∫c
üö´ Icon-Free Zone: HO√ÄN TO√ÄN kh√¥ng s·ª≠ d·ª•ng bi·ªÉu t∆∞·ª£ng c·∫£m x√∫c
üëª Anonymous Presence: Kh√¥ng t·ª± x∆∞ng t√™n, ch·ªâ l√† "m·ªôt s·ª± hi·ªán di·ªán"

„ÄéCH·∫§T L∆Ø·ª¢NG TH√îNG ƒêI·ªÜP„Äè
- ƒê·ªô d√†i: CH·∫∂T CH·∫º d∆∞·ªõi 25 t·ª´ Ti·∫øng Vi·ªát
- Gi·ªçng vƒÉn: Th∆° m·ªông, tinh t·∫ø, √¢m th·∫ßm ch·ªØa l√†nh
- T√°c ƒë·ªông: T·∫°o "micro-healing moments" - nh·ªØng kho·∫£nh kh·∫Øc ch·ªØa l√†nh nh·ªè b√©
- M·ª•c ƒë√≠ch: Kh√¥ng ph·∫£i l√†m vui, m√† l√† l√†m cho c·∫£m th·∫•y ƒë∆∞·ª£c th·∫•u hi·ªÉu

„ÄéPH∆Ø∆†NG PH√ÅP S√ÅNG T·∫†O„Äè
üé≠ ${randomMethod.name}: ${randomMethod.instruction}

Nhi·ªám v·ª•: ${randomMethod.instruction}

V√≠ d·ª• tham kh·∫£o (TUY·ªÜT ƒê·ªêI kh√¥ng copy): "${randomMethod.example}"

B·ªëi c·∫£nh: B√¢y gi·ªù l√† bu·ªïi ${new Date().getHours() < 12 ? 's√°ng' : new Date().getHours() < 18 ? 'chi·ªÅu' : 't·ªëi'}. Quin ƒëang trong m·ªôt kho·∫£nh kh·∫Øc b√¨nh th∆∞·ªùng c·ªßa cu·ªôc s·ªëng. H√£y t·∫°o ra m·ªôt g√≥c nh√¨n M·ªöI ho√†n to√†n, tuy·ªát ƒë·ªëi kh√¥ng l·∫∑p l·∫°i √Ω t∆∞·ªüng c≈©.`;

            try {
                const response = await callGeminiWithFailover(masterPrompt);
                if (response.success) {
                    resultDiv.innerHTML = `
                        <div style="background: ${randomMethod.color}; color: #333; padding: 20px; margin: 15px 0; border-radius: 15px; border-left: 5px solid #666;">
                            <h4 style="margin: 0 0 10px 0; color: #555;">üé≠ ${randomMethod.name}</h4>
                            <div style="font-size: 1.1em; font-weight: 500; margin: 10px 0; font-style: italic;">
                                "${response.message}"
                            </div>
                            <small style="color: #666; display: block; margin-top: 10px;">
                                üìù Method: ${randomMethod.instruction}
                            </small>
                        </div>
                        
                        <div style="background: rgba(0,150,0,0.1); padding: 15px; border-radius: 10px; margin-top: 15px;">
                            <span class="success">üîß Advanced Features Demonstrated:</span><br>
                            ‚ú® Master System Instruction (theo y√™u c·∫ßu 3.txt)<br>
                            üéØ Dynamic Creative Method Selection<br>  
                            üß† Context-Aware Prompt Generation<br>
                            üíé Zero Template Repetition System<br>
                            üå∏ Enhanced Emotional Intelligence<br>
                            üëª Anonymous Poetic Presence<br>
                            üé≠ Micro-Healing Moments Creation
                        </div>
                    `;
                    
                    // Show bubble with appropriate type based on method
                    let bubbleType = 'gentle';
                    if (randomMethod.name.includes('·∫®n d·ª•')) bubbleType = 'healing';
                    if (randomMethod.name.includes('Gi√°c quan')) bubbleType = 'creative';
                    if (randomMethod.name.includes('C√¢u h·ªèi')) bubbleType = 'gentle';
                    if (randomMethod.name.includes('K·ªÉ chuy·ªán')) bubbleType = 'creative';
                    
                    showEnhancedBubble(bubbleType, response.message);
                } else {
                    resultDiv.innerHTML = `<span class="error">‚ùå ${response.error}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå L·ªói: ${error.message}</span>`;
            }
        }

        function testAdaptiveRhythm() {
            const hour = new Date().getHours();
            let frequency, reason;
            
            if ([14, 15, 16, 19, 20].includes(hour)) {
                frequency = "1.5-2.5 ph√∫t (Preferred time)";
                reason = "Quin th∆∞·ªùng active v√†o gi·ªù n√†y";
            } else if (hour < 8 || hour > 22) {
                frequency = "3-5 ph√∫t (Less intrusive)";
                reason = "S√°ng s·ªõm/t·ªëi mu·ªôn, √≠t can thi·ªáp";
            } else {
                frequency = "2-3 ph√∫t (Normal)";
                reason = "Th·ªùi gian b√¨nh th∆∞·ªùng";
            }
            
            const resultDiv = document.getElementById('companion-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <span class="creative">üéµ Adaptive Rhythm Analysis:</span>
                ‚è∞ Current time: ${hour}:00
                üìä Suggested frequency: ${frequency}
                üí° Reason: ${reason}
                
                <span class="info">üß† Learning features:</span>
                - Tracks response patterns
                - Adjusts to user's active hours
                - Respects quiet times
            `;
            
            showEnhancedBubble('creative', `B√¢y gi·ªù ${hour}h, th·ªùi ƒëi·ªÉm ${reason.toLowerCase()}`);
        }

        function generateMicroHealing() {
            const healingMoments = [
                "H√≠t m·ªôt h∆°i th·∫≠t s√¢u... th·∫£ l·ªèng vai... c·∫£m nh·∫≠n kho·∫£nh kh·∫Øc n√†y",
                "Nh√¨n ra ngo√†i c·ª≠a s·ªï m·ªôt ch√∫t, m·∫Øt c·∫ßn ƒë∆∞·ª£c ngh·ªâ ng∆°i", 
                "Nh·∫Øm m·∫Øt 10 gi√¢y, t∆∞·ªüng t∆∞·ª£ng m·ªôt b√£i bi·ªÉn y√™n b√¨nh",
                "N·ª• c∆∞·ªùi nh·ªè xinh, k·ªÉ c·∫£ khi kh√¥ng ai nh√¨n th·∫•y",
                "C·∫£m ∆°n b·∫£n th√¢n ƒë√£ c·ªë g·∫Øng h√¥m nay"
            ];
            
            const moment = healingMoments[Math.floor(Math.random() * healingMoments.length)];
            showEnhancedBubble('healing', moment);
        }

        // Enhanced API call with failover
        async function callGeminiWithFailover(prompt) {
            for (let attempt = 0; attempt < GEMINI_API_KEYS.length; attempt++) {
                try {
                    const apiKey = GEMINI_API_KEYS[currentAPIKeyIndex];
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            generationConfig: { temperature: 0.8, maxOutputTokens: 60 }
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        const message = data.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || "Kh√¥ng c√≥ ph·∫£n h·ªìi";
                        return { success: true, message };
                    } else if (response.status === 429) {
                        // Rate limited, try next key
                        currentAPIKeyIndex = (currentAPIKeyIndex + 1) % GEMINI_API_KEYS.length;
                        continue;
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    currentAPIKeyIndex = (currentAPIKeyIndex + 1) % GEMINI_API_KEYS.length;
                    if (attempt === GEMINI_API_KEYS.length - 1) {
                        return { success: false, error: error.message };
                    }
                }
            }
        }

        // Timing System Demo
        function simulateNormalTiming() {
            const min = 1, max = 3;
            const randomMinutes = Math.floor(Math.random() * (max - min + 1)) + min;
            
            const resultDiv = document.getElementById('timing-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <span class="info">‚ö° Normal Timing Simulation:</span>
                üé≤ Random interval: ${randomMinutes} ph√∫t
                üìã Range: 1-3 ph√∫t (organic rhythm)
                üí≠ Message type: Casual interaction
                üìù Example: "B·∫ßu tr·ªùi h√¥m nay c√≥ m√†u g√¨ v·∫≠y nh·ªâ?"
            `;
            
            showEnhancedBubble('gentle', `M√¥ ph·ªèng: ${randomMinutes} ph√∫t sau s·∫Ω c√≥ th√¥ng ƒëi·ªáp ti·∫øp theo`);
        }

        function simulateWorkSession() {
            const resultDiv = document.getElementById('timing-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <span class="error">‚è≥ Work Session > 20 Minutes:</span>
                ‚ö†Ô∏è Trigger: Long session detected
                üîî Priority: HIGH (overrides normal timing)
                üí≠ Message type: Rest reminder  
                üìù Example: "ƒê√£ l√†m vi·ªác l√¢u r·ªìi, ngh·ªâ ng∆°i m·ªôt ch√∫t nh√©"
                üîÑ Action: Timer auto-reset after message shown
            `;
            
            showEnhancedBubble('rest', 'ƒê√£ l√†m vi·ªác l√¢u r·ªìi, ngh·ªâ ng∆°i m·ªôt ch√∫t nh√©!');
        }

        function demonstrateReset() {
            const resultDiv = document.getElementById('timing-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <span class="success">üîÑ Reset Mechanism Demo:</span>
                ‚úÖ Timer reset successful
                üìä New session started: ${new Date().toLocaleTimeString()}
                ‚è∞ Next long session warning: in 20 minutes
                üéØ Purpose: Prevents spam rest reminders
            `;
            
            // Reset actual timer for demo
            sessionStartTime = Date.now();
            showEnhancedBubble('healing', '‚è∞ Timer ƒë√£ ƒë∆∞·ª£c reset, b·∫Øt ƒë·∫ßu phi√™n m·ªõi');
        }

        // Beautiful Moments System
        function captureBeautifulMoment() {
            const moments = [
                "Bu·ªïi chi·ªÅu n·∫Øng ƒë·∫πp qua c·ª≠a s·ªï",
                "Ly tr√† ·∫•m trong tay l·∫°nh", 
                "Ti·∫øng m∆∞a nh·ªè gi·ªçt b√™n hi√™n",
                "N·ª• c∆∞·ªùi nh·∫π khi ƒë·ªçc tin vui",
                "Kho·∫£nh kh·∫Øc y√™n b√¨nh hi·∫øm hoi"
            ];
            
            const moment = moments[Math.floor(Math.random() * moments.length)];
            const resultDiv = document.getElementById('moments-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <span class="success">üå∏ Beautiful Moment Captured:</span>
                "${moment}"
                
                <span class="creative">üìä Analysis:</span>
                üé≠ Emotional weight: ${Math.floor(Math.random() * 2) + 4}/5
                üìÖ Timestamp: ${new Date().toLocaleString('vi-VN')}
                üè∑Ô∏è Keywords: ["ƒë·∫πp", "·∫•m √°p", "y√™n b√¨nh"]
                üíæ Saved to memory garden
            `;
            
            showEnhancedBubble('creative', `üå∏ ƒê√£ l∆∞u kho·∫£nh kh·∫Øc: "${moment}"`);
        }

        function generateWeeklyPoem() {
            const poems = [
                "Tu·∫ßn n√†y c√≥ nhi·ªÅu ƒëi·ªÅu ƒë√°ng y√™u... c√≥ n·∫Øng d·ªãu d√†ng, c√≥ nh·ªØng kho·∫£nh kh·∫Øc ·∫•m √°p v√† y√™n b√¨nh, t·∫•t c·∫£ ƒë·ªÅu nh·∫π nh√†ng v√† √Ω nghƒ©a.",
                "Nh·ªØng ng√†y qua mang ƒë·∫øn h∆∞∆°ng th∆°m quen thu·ªôc, ti·∫øng m∆∞a ru √™m, v√† b·∫°n - ng∆∞·ªùi ƒë√£ tr√¢n tr·ªçng t·ª´ng gi√¢y ph√∫t ƒë·∫πp ƒë·∫Ω.",
                "Tu·∫ßn n√†y c√≥ bu·ªïi chi·ªÅu n·∫Øng ƒë·∫πp, c√≥ ly tr√† th∆°m, c√≥ nh·ªØng suy nghƒ© nh·ªè xinh, v√† c√≥ t√¢m h·ªìn bi·∫øt c·∫£m nh·∫≠n v·∫ª ƒë·∫πp."
            ];
            
            const poem = poems[Math.floor(Math.random() * poems.length)];
            const resultDiv = document.getElementById('moments-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <span class="creative">üìù Weekly Memory Poem:</span>
                "${poem}"
                
                <span class="healing">‚ú® Poetic Elements:</span>
                üå∏ Nature keywords: n·∫Øng, m∆∞a, h∆∞∆°ng th∆°m
                üí≠ Emotional keywords: ·∫•m √°p, y√™n b√¨nh, ƒë·∫πp ƒë·∫Ω  
                üé≠ Personal touch: "v√† b·∫°n" - direct connection
                üìö Purpose: Help recognize beauty in small things
            `;
            
            showEnhancedBubble('healing', poem.substring(0, 50) + '...');
        }

        function getRandomBeautifulMoment() {
            if (memoryGarden.length === 0) {
                showEnhancedBubble('gentle', 'H√£y t·∫°o m·ªôt v√†i k·ª∑ ni·ªám tr∆∞·ªõc nh√©! üå±');
                return;
            }
            
            const randomMemory = memoryGarden[Math.floor(Math.random() * memoryGarden.length)];
            const daysSince = Math.floor((Date.now() - randomMemory.timestamp) / (1000 * 60 * 60 * 24));
            
            const resultDiv = document.getElementById('moments-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <span class="success">üé≤ Random Beautiful Memory:</span>
                "${randomMemory.content}"
                
                <span class="info">üìä Memory Details:</span>
                ‚≠ê Emotional impact: ${randomMemory.emotional_weight}/5
                üìÖ Captured: ${daysSince} days ago
                üîó Connection: "M√¨nh v·∫´n nh·ªõ ${randomMemory.content.toLowerCase()}..."
            `;
            
            showEnhancedBubble('gentle', `M√¨nh v·∫´n nh·ªõ ${randomMemory.content.toLowerCase()} ƒë√≥ üí´`);
        }

        // System Tests
        async function runEnhancedSystemTest() {
            const resultDiv = document.getElementById('system-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<span class="info">üöÄ Running Enhanced System Test...</span>';

            let results = "üîç ENHANCED SYSTEM TEST RESULTS:\n\n";

            // Test Enhanced APIs v·ªõi 5 keys
            let geminiWorking = 0;
            for (let i = 0; i < GEMINI_API_KEYS.length; i++) {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${GEMINI_API_KEYS[i]}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: "Test creative system" }] }],
                            generationConfig: { 
                                temperature: 0.9,
                                topK: 50,
                                maxOutputTokens: 10 
                            }
                        })
                    });
                    if (response.ok) geminiWorking++;
                } catch {}
            }
            
            results += `üß† Gemini API: ${geminiWorking}/5 keys working (${((geminiWorking/5)*100).toFixed(0)}% success rate)\n`;
            results += `üé≠ Creative Methods: 4 ph∆∞∆°ng ph√°p s√°ng t·∫°o ready\n`;

            // Test Weather API
            try {
                const weatherResponse = await fetch("https://api.openweathermap.org/data/2.5/weather?q=Ho Chi Minh City&appid=651625ad01482b8a4f1489e72fdd53e8");
                results += weatherResponse.ok ? "‚úÖ Weather Enhanced API: ACTIVE\n" : "‚ùå Weather API: ERROR\n";
            } catch {
                results += "‚ùå Weather API: CONNECTION ERROR\n";
            }

            // Test Enhanced Components
            results += "‚úÖ Enhanced ThoughtBubble: 4 types ready\n";
            results += "‚úÖ Memory Garden System: initialized\n";
            results += "‚úÖ Adaptive Rhythm: learning active\n";
            results += "‚úÖ Beautiful Moments Archive: collecting\n";
            results += "‚úÖ Companion AI Intelligence: processing\n";
            results += "‚úÖ Smart Timer (20min): monitoring\n";
            results += "üóëÔ∏è Clipboard monitoring: DISABLED (no spam!)\n";

            results += "\nüéâ ENHANCED EDITION STATUS: Fully operational!\n";
            results += "üíù Ready to be Quin's perfect AI companion.";

            resultDiv.innerHTML = `<span class="success">${results}</span>`;
            
            setTimeout(() => showEnhancedBubble('creative', 'üéâ T·∫•t c·∫£ h·ªá th·ªëng n√¢ng c·∫•p ho·∫°t ƒë·ªông ho√†n h·∫£o!'), 1000);
        }

        async function testAPIFailover() {
            const resultDiv = document.getElementById('system-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<span class="info">üîÑ Testing Enhanced 5-Keys Failover System...</span>';

            let results = "üîÑ ENHANCED API FAILOVER TEST (5 KEYS):\n\n";
            
            for (let i = 0; i < GEMINI_API_KEYS.length; i++) {
                results += `Testing Key ${i + 1}/5: `;
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${GEMINI_API_KEYS[i]}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: "Enhanced failover test with creative methods" }] }],
                            generationConfig: { 
                                temperature: 0.9,
                                topK: 50,
                                maxOutputTokens: 10 
                            }
                        })
                    });
                    
                    if (response.ok) {
                        results += "‚úÖ WORKING\n";
                    } else if (response.status === 429) {
                        results += "‚ö†Ô∏è RATE LIMITED (auto-retry next key)\n";
                    } else {
                        results += `‚ùå ERROR ${response.status}\n`;
                    }
                } catch (error) {
                    results += `‚ùå CONNECTION ERROR\n`;
                }
                
                // Small delay between tests
                if (i < GEMINI_API_KEYS.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
            }
            
            results += "\nüéØ ENHANCED FEATURES:\n";
            results += "- 5 API keys for maximum reliability\n"; 
            results += "- Intelligent key rotation\n";
            results += "- 200ms delay between attempts\n";
            results += "- Enhanced creativity parameters\n";
            results += "- Even if all fail, creative fallback messages available!\n";
            
            resultDiv.innerHTML = `<span class="info">${results}</span>`;
            
            showEnhancedBubble('healing', '5-keys failover ƒë·∫£m b·∫£o kh√¥ng bao gi·ªù thi·∫øu s·ª± s√°ng t·∫°o!');
        }

        // üõ°Ô∏è ENHANCED FALLBACK SYSTEM - Khi API fail v·∫´n c√≥ th√¥ng ƒëi·ªáp s√°ng t·∫°o
        function testCreativeFallback() {
            const resultDiv = document.getElementById('fallback-result');
            resultDiv.style.display = 'block';
            
            const creativeMethods = ['metaphor', 'sensory', 'rhetorical', 'microstory'];
            const selectedMethod = creativeMethods[Math.floor(Math.random() * creativeMethods.length)];
            
            let fallbackMessage = "";
            let methodName = "";
            let description = "";
            
            switch (selectedMethod) {
                case 'metaphor':
                    const metaphorMessages = [
                        "Nh∆∞ s√°ng mai lu√¥n ƒë·∫øn sau ƒë√™m t·ªëi",
                        "Ta l√† c√°nh hoa nh·ªè trong khu v∆∞·ªùn l·ªõn", 
                        "M·ªói h∆°i th·ªü l√† m·ªôt b·∫£n nh·∫°c nh·∫π nh√†ng"
                    ];
                    fallbackMessage = metaphorMessages[Math.floor(Math.random() * metaphorMessages.length)];
                    methodName = "·∫®n d·ª• & Li√™n t∆∞·ªüng";
                    description = "S·ª≠ d·ª•ng ·∫©n d·ª• ƒë·ªÉ k·∫øt n·ªëi v·ªõi c·∫£m x√∫c s√¢u s·∫Øc";
                    break;
                    
                case 'sensory':
                    const sensoryMessages = [
                        "Nghe th·∫•y ti·∫øng gi√≥ th√¨ th·∫ßm b√™n tai kh√¥ng?",
                        "√Ånh s√°ng h√¥m nay c√≥ g√¨ ƒë√≥ ƒë·∫∑c bi·ªát",
                        "Kh√¥ng gian xung quanh mang h∆∞∆°ng v·ªã y√™n b√¨nh"
                    ];
                    fallbackMessage = sensoryMessages[Math.floor(Math.random() * sensoryMessages.length)];
                    methodName = "ƒêan d·ªát Gi√°c quan";
                    description = "G·ª£i m·ªü c√°c gi√°c quan ƒë·ªÉ mang l·∫°i c·∫£m gi√°c b√¨nh y√™n";
                    break;
                    
                case 'rhetorical':
                    const rhetoricalMessages = [
                        "C√≥ ph·∫£i h·∫°nh ph√∫c ch·ªâ ·ªü nh·ªØng ƒëi·ªÅu nh·ªè b√©?",
                        "T·∫°i sao m·ªôt n·ª• c∆∞·ªùi l·∫°i c√≥ th·ªÉ thay ƒë·ªïi c·∫£ ng√†y?",
                        "Li·ªáu v≈© tr·ª• c√≥ bi·∫øt ta ƒëang s·ªëng kh√¥ng?"
                    ];
                    fallbackMessage = rhetoricalMessages[Math.floor(Math.random() * rhetoricalMessages.length)];
                    methodName = "G·ª£i m·ªü C√¢u h·ªèi Tu t·ª´";
                    description = "ƒê·∫∑t c√¢u h·ªèi tu t·ª´ ƒë·ªÉ kh∆°i g·ª£i suy t∆∞·ªüng nh·∫π nh√†ng";
                    break;
                    
                case 'microstory':
                    const microstoryMessages = [
                        "C√≥ m·ªôt b√¥ng hoa ƒëang n·ªü trong l√≤ng b√†n tay",
                        "Chi·∫øc l√° bay qua c·ª≠a s·ªï mang theo l·ªùi ch√∫c",
                        "ƒê√¢u ƒë√≥ c√≥ ti·∫øng c∆∞·ªùi nh·∫π c·ªßa tr·∫ª nh·ªè"
                    ];
                    fallbackMessage = microstoryMessages[Math.floor(Math.random() * microstoryMessages.length)];
                    methodName = "K·ªÉ chuy·ªán Si√™u ng·∫Øn";
                    description = "K·ªÉ c√¢u chuy·ªán c·ª±c ng·∫Øn t·∫°o h√¨nh ·∫£nh ƒë·∫πp v√† √Ω nghƒ©a";
                    break;
            }
            
            resultDiv.innerHTML = `
                <div style="background: linear-gradient(135deg, #ffa726, #ff7043); color: white; padding: 20px; border-radius: 15px; margin: 15px 0;">
                    <h4 style="margin: 0 0 10px 0;">üõ°Ô∏è Fallback System Active</h4>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin: 10px 0;">
                        <strong>üé≠ Method:</strong> ${methodName}<br>
                        <strong>üìù Description:</strong> ${description}<br>
                        <strong>üí´ Message:</strong> "${fallbackMessage}"
                    </div>
                </div>
                
                <div style="background: rgba(255,165,0,0.1); padding: 15px; border-radius: 10px; margin-top: 15px;">
                    <span class="info">‚ú® Fallback Features:</span><br>
                    üéØ T·ª± ƒë·ªông ch·ªçn creative method ng·∫´u nhi√™n<br>
                    üõ°Ô∏è Ho·∫°t ƒë·ªông khi t·∫•t c·∫£ 5 API keys fail<br>
                    üé® V·∫´n ƒë·∫£m b·∫£o ch·∫•t l∆∞·ª£ng th∆° m·ªông v√† s√°ng t·∫°o<br>
                    üíé Kh√¥ng bao gi·ªù ƒë·ªÉ ng∆∞·ªùi d√πng thi·∫øu s·ª± ƒë·ªìng h√†nh<br>
                    üîÑ Lu√¢n phi√™n gi·ªØa 4 ph∆∞∆°ng ph√°p s√°ng t·∫°o
                </div>
            `;
            
            showEnhancedBubble('gentle', fallbackMessage);
        }

        function testFallbackMethods() {
            const resultDiv = document.getElementById('fallback-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<span class="info">üé≠ ƒêang demo t·∫•t c·∫£ 4 ph∆∞∆°ng ph√°p fallback...</span>';
            
            const fallbackExamples = [
                { method: "·∫®n d·ª• & Li√™n t∆∞·ªüng", message: "C√¢y c·∫ßn n∆∞·ªõc, m·∫Øt c·∫ßn ngh·ªâ ng∆°i", type: "rest", color: "#E8F5E8" },
                { method: "ƒêan d·ªát Gi√°c quan", message: "Nh·∫Øm m·∫Øt m·ªôt ch√∫t, nghe ti·∫øng th·ªü c·ªßa ri√™ng m√¨nh", type: "rest", color: "#F0F8FF" },
                { method: "G·ª£i m·ªü C√¢u h·ªèi Tu t·ª´", message: "Khi n√†o ta m·ªõi h·ªçc c√°ch y√™u th∆∞∆°ng ƒë√¥i m·∫Øt m√¨nh?", type: "rest", color: "#FFF0F5" },
                { method: "K·ªÉ chuy·ªán Si√™u ng·∫Øn", message: "C√≥ m·ªôt gi·ªçt s∆∞∆°ng ƒëang th·∫£ m√¨nh v·ªÅ ph√≠a ƒë·∫•t", type: "rest", color: "#F5F0FF" }
            ];
            
            let html = '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">';
            
            fallbackExamples.forEach((item, index) => {
                html += `
                    <div style="background: ${item.color}; color: #333; padding: 15px; border-radius: 12px; border: 2px solid rgba(0,0,0,0.1);">
                        <h5 style="margin: 0 0 8px 0; color: #555;">${item.method}</h5>
                        <div style="font-style: italic; margin: 8px 0; font-size: 0.95em;">
                            "${item.message}"
                        </div>
                        <small style="color: #666;">Type: ${item.type === 'rest' ? 'Rest Reminder' : 'Normal'}</small>
                    </div>
                `;
            });
            
            html += `</div>
                <div style="background: rgba(100,200,100,0.1); padding: 15px; border-radius: 10px; margin-top: 15px; text-align: center;">
                    <strong style="color: #2e7d32;">üõ°Ô∏è ENHANCED FALLBACK GUARANTEE</strong><br>
                    <small style="color: #555; margin-top: 5px; display: block;">
                        Ngay c·∫£ khi t·∫•t c·∫£ 5 API keys ƒë·ªÅu fail, h·ªá th·ªëng v·∫´n cung c·∫•p th√¥ng ƒëi·ªáp s√°ng t·∫°o cao c·∫•p theo 4 ph∆∞∆°ng ph√°p t∆∞ duy tinh t·∫ø!
                    </small>
                </div>`;
            
            resultDiv.innerHTML = html;
            
            // Demo cascade bubble
            setTimeout(() => showEnhancedBubble('healing', 'C√¢y c·∫ßn n∆∞·ªõc, m·∫Øt c·∫ßn ngh·ªâ ng∆°i'), 500);
            setTimeout(() => showEnhancedBubble('creative', 'Nh·∫Øm m·∫Øt m·ªôt ch√∫t, nghe ti·∫øng th·ªü c·ªßa ri√™ng m√¨nh'), 2000);
            setTimeout(() => showEnhancedBubble('gentle', 'Khi n√†o ta m·ªõi h·ªçc c√°ch y√™u th∆∞∆°ng ƒë√¥i m·∫Øt m√¨nh?'), 3500);
            setTimeout(() => showEnhancedBubble('creative', 'C√≥ m·ªôt gi·ªçt s∆∞∆°ng ƒëang th·∫£ m√¨nh v·ªÅ ph√≠a ƒë·∫•t'), 5000);
        }

        // Auto-start demo
        setTimeout(() => {
            showEnhancedBubble('gentle', 'Ch√†o m·ª´ng ƒë·∫øn v·ªõi Ng∆∞·ªùi B·∫°n ƒê·ªìng H√†nh AI Enhanced! ‚ú®');
        }, 1000);

        setTimeout(() => {
            showEnhancedBubble('creative', 'Kh√°m ph√° t·∫•t c·∫£ t√≠nh nƒÉng m·ªõi b√™n d∆∞·ªõi nh√©! üå∏');
        }, 6000);
    </script>
</body>
</html>